
=====================================================

# Archivo: .gitignore

node_modules/
.env

=====================================================

# Archivo: app.js

// app.js
// -------------------- Imports --------------------
import express from 'express';
import path from 'path';
import { fileURLToPath } from 'url';
import methodOverride from 'method-override';
import dotenv from 'dotenv';
import cookieParser from 'cookie-parser'; 
import jwt from 'jsonwebtoken';

// Importar rutas de autenticaciÃ³n
import authRoutes from './routes/authRoutes.js'; 
import { verificarAuth } from './middleware/auth.js'; 

// Importar routers API
import tareaRoutes from './routes/tareaRoutes.js';
import empleadoRoutes from './routes/empleadoRoutes.js';
import clienteRoutes from './routes/clienteRoutes.js';
import eventoRoutes from './routes/eventoRoutes.js';

// Importar routers WEB (vistas)
import clienteWebRoutes from './routes/clienteWebRoutes.js';
import eventoWebRoutes from './routes/eventoWebRoutes.js';
import empleadoWebRoutes from './routes/empleadoWebRoutes.js'; // Rutas web para manejo de empleados (vistas)
import tareaWebRoutes from './routes/tareaWebRoutes.js';       // Rutas web para manejo de tareas (vistas)

// Modelos (usarÃ¡n Mongoose internamente)
import ClienteModel from './models/ClienteModel.js';
import EmpleadoModel from './models/EmpleadoModel.js';
import EventoModel from './models/EventoModel.js';
import TareaModel from './models/TareaModel.js';
import UsuarioModel from './models/UsuarioModel.js';

// ConexiÃ³n a Mongo
import { connectMongo } from './db/mongoose.js';

// -------------------- ConfiguraciÃ³n --------------------
dotenv.config();

const app = express();
const PORT = process.env.PORT || 3000;

// ConfiguraciÃ³n de __dirname
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// -------------------- Middlewares --------------------
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(methodOverride('_method'));
app.use(cookieParser());

// Archivos estÃ¡ticos
app.use(express.static(path.join(__dirname, 'publics')));

// Middleware global para verificar usuario en TODAS las vistas
app.use(async (req, res, next) => {
  res.locals.currentPath = req.path;
  res.locals.usuario = null;
  
  try {
    const token = req.cookies?.token;
    
    if (token) {
      const decoded = jwt.verify(token, process.env.JWT_SECRET);
      const usuario = await UsuarioModel.getById(decoded.id);
      
      if (usuario) {
        res.locals.usuario = usuario;
        req.usuario = usuario;
      }
    }
  } catch (error) {
    // Silenciosamente continuar sin usuario
  }
  
  next();
});

// -------------------- Motor de vistas --------------------
app.set('view engine', 'pug');
app.set('views', path.join(__dirname, 'views'));

// -------------------- Rutas PÃºblicas --------------------
app.use('/auth', authRoutes);

// -------------------- Ruta Principal --------------------
app.get('/', verificarAuth, async (req, res) => {
  try {
    const tareas = await TareaModel.getAll();
    const empleados = await EmpleadoModel.getAll();
    const clientes = await ClienteModel.getAll();
    const eventos = await EventoModel.getAll();

    res.render('index', {
      title: 'Eventify - Backend',
      tareas,
      empleados,
      clientes,
      eventos
    });
  } catch (error) {
    console.error('Error al cargar index:', error);
    res.status(500).render('error', { 
      title: 'Error', 
      message: 'Error al cargar la pÃ¡gina principal' 
    });
  }
});

// -------------------- Rutas Web Protegidas --------------------
app.use('/clientes', verificarAuth, clienteWebRoutes);
app.use('/eventos', verificarAuth, eventoWebRoutes);
// Registrar rutas web protegidas (requieren autenticaciÃ³n)
app.use('/empleados', verificarAuth, empleadoWebRoutes);
app.use('/tareas', verificarAuth, tareaWebRoutes);

// -------------------- APIs Protegidas --------------------
app.use('/api/clientes', verificarAuth, clienteRoutes);
app.use('/api/empleados', verificarAuth, empleadoRoutes);
app.use('/api/eventos', verificarAuth, eventoRoutes);
app.use('/api/tareas', verificarAuth, tareaRoutes);

// -------------------- Manejo de rutas no encontradas --------------------
app.use((req, res) => {
  res.status(404).render('error', { 
    title: '404', 
    message: 'Ruta no encontrada' 
  });
});

// -------------------- Iniciar Servidor --------------------
connectMongo(process.env.MONGODB_URI)
  .then(() => {
    app.listen(PORT, () => {
        console.log(`Servidor corriendo en http://localhost:${PORT}`);
          console.log(`AutenticaciÃ³n: http://localhost:${PORT}/auth/login`);
      console.log(`Dashboard: http://localhost:${PORT}/`);
    });
  })
  .catch((err) => {
    console.error('Error conectando a Mongo:', err);
    process.exit(1);
  });

=====================================================

# Archivo: controllers\authController.js

// controllers/authController.js
import UsuarioModel from '../models/UsuarioModel.js';
import { generarToken } from '../middleware/auth.js';

// Mostrar formulario de registro
export function mostrarRegistro(req, res) {
  res.render('auth/registro', {
    title: 'Registro - Eventify',
    error: null
  });
}

// âœï¸ Procesar registro
export async function registrar(req, res) {
  try {
    const { nombre, email, password, passwordConfirm, rol, area } = req.body;

    // Validaciones
    if (!nombre || !email || !password || !rol || !area) {
      return res.render('auth/registro', {
        title: 'Registro - Eventify',
        error: 'Todos los campos son obligatorios'
      });
    }

    if (password !== passwordConfirm) {
      return res.render('auth/registro', {
        title: 'Registro - Eventify',
        error: 'Las contraseÃ±as no coinciden'
      });
    }

    if (password.length < 6) {
      return res.render('auth/registro', {
        title: 'Registro - Eventify',
        error: 'La contraseÃ±a debe tener al menos 6 caracteres'
      });
    }

    // Verificar si el email ya existe
    const usuarioExistente = await UsuarioModel.getByEmail(email);
    if (usuarioExistente) {
      return res.render('auth/registro', {
        title: 'Registro - Eventify',
        error: 'El email ya estÃ¡ registrado'
      });
    }

    // Crear usuario
    const nuevoUsuario = await UsuarioModel.add({
      nombre,
      email,
      password,
      rol,
      area
    });

    if (!nuevoUsuario) {
      return res.render('auth/registro', {
        title: 'Registro - Eventify',
        error: 'Error al crear el usuario'
      });
    }

    // Generar token
    const token = generarToken(nuevoUsuario.id);

    // Guardar token en cookie
    res.cookie('token', token, {
      httpOnly: true,
      maxAge: 7 * 24 * 60 * 60 * 1000 // 7 dÃ­as
    });

    res.redirect('/');
  } catch (error) {
    console.error('Error en registro:', error);
    res.render('auth/registro', {
      title: 'Registro - Eventify',
      error: 'Error al procesar el registro'
    });
  }
}

// ðŸ”“ Mostrar formulario de login
export function mostrarLogin(req, res) {
  res.render('auth/login', {
    title: 'Iniciar SesiÃ³n - Eventify',
    error: null
  });
}

// Procesar login
export async function login(req, res) {
  try {
    const { email, password } = req.body;

    // Validaciones
    if (!email || !password) {
      return res.render('auth/login', {
        title: 'Iniciar SesiÃ³n - Eventify',
        error: 'Email y contraseÃ±a son obligatorios'
      });
    }

    // Buscar usuario
    const usuario = await UsuarioModel.getByEmail(email);
    if (!usuario) {
      return res.render('auth/login', {
        title: 'Iniciar SesiÃ³n - Eventify',
        error: 'Email o contraseÃ±a incorrectos'
      });
    }

    // Verificar contraseÃ±a
    const passwordValido = await usuario.compararPassword(password);
    if (!passwordValido) {
      return res.render('auth/login', {
        title: 'Iniciar SesiÃ³n - Eventify',
        error: 'Email o contraseÃ±a incorrectos'
      });
    }

    // Generar token
    const token = generarToken(usuario._id);

    // Guardar token en cookie
    res.cookie('token', token, {
      httpOnly: true,
      maxAge: 7 * 24 * 60 * 60 * 1000 // 7 dÃ­as
    });

    res.redirect('/');
  } catch (error) {
    console.error('Error en login:', error);
    res.render('auth/login', {
      title: 'Iniciar SesiÃ³n - Eventify',
      error: 'Error al procesar el login'
    });
  }
}

// Cerrar sesiÃ³n
export function logout(req, res) {
  res.clearCookie('token');
  res.redirect('/auth/login');
}

// Obtener perfil del usuario actual
export async function perfil(req, res) {
  res.render('auth/perfil', {
    title: 'Mi Perfil - Eventify',
    usuario: req.usuario
  });
}

=====================================================

# Archivo: controllers\clienteController.js

// controllers/clienteController.js
// -------------------- CONTROLADOR DE CLIENTES --------------------
import ClienteModel from '../models/ClienteModel.js';

// -------------------- LISTAR TODOS LOS CLIENTES --------------------
// GET /clientes
async function listClientes(req, res) {
  try {
    const clientes = await ClienteModel.getAll();
    res.json(clientes);
  } catch (error) {
    console.error('Error al listar clientes:', error);
    res.status(500).json({ mensaje: 'Error al obtener clientes' });
  }
}

// -------------------- OBTENER CLIENTE POR ID --------------------
// GET /clientes/:id
async function getCliente(req, res) {
  try {
    const cliente = await ClienteModel.getById(req.params.id);
    if (!cliente) return res.status(404).json({ mensaje: 'Cliente no encontrado' });
    res.json(cliente);
  } catch (error) {
    console.error('Error al obtener cliente:', error);
    res.status(500).json({ mensaje: 'Error al obtener cliente' });
  }
}

// -------------------- CREAR NUEVO CLIENTE --------------------
// POST /clientes
async function addCliente(req, res) {
  try {
    const cliente = req.body;
    if (!cliente.nombre || !cliente.email) {
      return res.status(400).json({ mensaje: 'Nombre y correo son obligatorios' });
    }
    const nuevoCliente = await ClienteModel.add(cliente);
    res.status(201).json({ mensaje: 'Cliente creado', cliente: nuevoCliente });
  } catch (error) {
    console.error('Error al crear cliente:', error);
    res.status(500).json({ mensaje: 'Error al crear cliente' });
  }
}

// -------------------- ACTUALIZAR CLIENTE COMPLETO --------------------
// PUT /clientes/:id
async function updateCliente(req, res) {
  try {
    const actualizado = await ClienteModel.update(req.params.id, req.body);
    if (!actualizado) return res.status(404).json({ mensaje: 'Cliente no encontrado' });
    res.json({ mensaje: 'Cliente actualizado', cliente: actualizado });
  } catch (error) {
    console.error('Error al actualizar cliente:', error);
    res.status(500).json({ mensaje: 'Error al actualizar cliente' });
  }
}

// -------------------- ACTUALIZAR PARCIALMENTE CLIENTE --------------------
// PATCH /clientes/:id
async function patchCliente(req, res) {
  try {
    const actualizado = await ClienteModel.patch(req.params.id, req.body);
    if (!actualizado) return res.status(404).json({ mensaje: 'Cliente no encontrado' });
    res.json({ mensaje: 'Cliente actualizado parcialmente', cliente: actualizado });
  } catch (error) {
    console.error('Error al actualizar parcialmente cliente:', error);
    res.status(500).json({ mensaje: 'Error al actualizar parcialmente cliente' });
  }
}

// -------------------- ELIMINAR CLIENTE --------------------
// DELETE /clientes/:id
async function deleteCliente(req, res) {
  try {
    const eliminado = await ClienteModel.remove(req.params.id);
    if (!eliminado) return res.status(404).json({ mensaje: 'Cliente no encontrado' });
    res.json({ mensaje: 'Cliente eliminado', cliente: eliminado });
  } catch (error) {
    console.error('Error al eliminar cliente:', error);
    res.status(500).json({ mensaje: 'Error al eliminar cliente' });
  }
}

export default { listClientes, getCliente, addCliente, updateCliente, patchCliente, deleteCliente };


=====================================================

# Archivo: controllers\ClienteWebController.js

// -------------------- CONTROLADOR WEB DE CLIENTES --------------------
import ClienteModel from '../models/ClienteModel.js';
import EventoModel from '../models/EventoModel.js';

/**
 * Listar todos los clientes y renderizar la vista index.pug
 */
const listClientesWeb = async (req, res) => {
  try {
    let clientes = await ClienteModel.getAll();

    // ðŸ”§ Asegurar compatibilidad con MongoDB
    clientes = clientes.map(c => ({ ...c, id: c.id || c._id?.toString() }));

    res.render('clientes/index', {
      title: 'Clientes - Eventify',
      clientes,
      currentPath: req.baseUrl || req.path
    });
  } catch (error) {
    console.error('Error al cargar clientes:', error);
    res
      .status(500)
      .render('error', { title: 'Error - Eventify', message: 'Error al cargar la lista de clientes' });
  }
};

/**
 * Mostrar formulario para crear un nuevo cliente
 */
const showNewForm = (req, res) => {
  res.render('clientes/form', {
    title: 'Nuevo Cliente - Eventify',
    formTitle: 'Nuevo Cliente',
    cliente: null,
    formAction: '/clientes'
  });
};

/**
 * Mostrar formulario para editar un cliente existente
 */
const showEditForm = async (req, res) => {
  try {
    let cliente = await ClienteModel.getById(req.params.id);
    if (!cliente)
      return res
        .status(404)
        .render('error', { title: 'Error', message: 'Cliente no encontrado' });

    // ðŸ”§ Asegurar compatibilidad
    cliente.id = cliente.id || cliente._id?.toString();

    res.render('clientes/form', {
      title: 'Editar Cliente - Eventify',
      formTitle: 'Editar Cliente',
      cliente,
      formAction: `/clientes/${cliente.id}?_method=PUT`
    });
  } catch (error) {
    console.error(error);
    res
      .status(500)
      .render('error', { title: 'Error', message: 'Error al cargar el cliente' });
  }
};

/**
 * Mostrar los detalles de un cliente individual
 */
const showCliente = async (req, res) => {
  try {
    let cliente = await ClienteModel.getById(req.params.id);
    if (!cliente)
      return res
        .status(404)
        .render('error', { title: 'Error', message: 'Cliente no encontrado' });

    cliente.id = cliente.id || cliente._id?.toString();

    // Obtener eventos relacionados con este cliente
    const eventosRaw = await EventoModel.getAll();
    const eventos = eventosRaw
      .filter(ev => {
        // ev puede contener clienteIdString (set in toPlain) o clienteId como objeto
        let cid = null;
        if (ev.clienteIdString) cid = ev.clienteIdString;
        else if (ev.clienteId && typeof ev.clienteId === 'object') cid = String(ev.clienteId._id || ev.clienteId);
        else cid = ev.clienteId;
        return String(cid) === String(cliente.id);
      })
      .map(ev => ({
        // Normalizar identificador para compatibilidad con distintas representaciones
        id: ev.id || ev._id || (ev._id && ev._id.toString()),
        _id: ev._id || ev.id,
        nombre: ev.nombre,
        lugar: ev.lugar,
        fecha_inicio: ev.fechaInicio || ev.fecha_inicio,
        cliente: ev.clienteId || ev.cliente
      }));

    res.render('clientes/show', { title: `${cliente.nombre} - Eventify`, cliente, eventos });
  } catch (error) {
    console.error(error);
    res
      .status(500)
      .render('error', { title: 'Error', message: 'Error al cargar el cliente' });
  }
};

/**
 * Crear un nuevo cliente (desde formulario web)
 */
const createClienteWeb = async (req, res) => {
  try {
    await ClienteModel.add(req.body);
    res.redirect('/clientes');
  } catch (error) {
    console.error(error);
    res
      .status(500)
      .render('error', { title: 'Error', message: 'Error al crear el cliente' });
  }
};

/**
 * Actualizar un cliente existente (desde formulario web)
 */
const updateClienteWeb = async (req, res) => {
  try {
    const actualizado = await ClienteModel.update(req.params.id, req.body);
    if (!actualizado)
      return res
        .status(404)
        .render('error', { title: 'Error', message: 'Cliente no encontrado' });

    res.redirect('/clientes');
  } catch (error) {
    console.error(error);
    res
      .status(500)
      .render('error', { title: 'Error', message: 'Error al actualizar el cliente' });
  }
};

/**
 * Eliminar un cliente (con soporte para AJAX/fetch o redirecciÃ³n normal)
 */
const deleteClienteWeb = async (req, res) => {
  try {
    const eliminado = await ClienteModel.remove(req.params.id);
    if (!eliminado)
      return res
        .status(404)
        .render('error', { title: 'Error', message: 'Cliente no encontrado' });

    // Si la peticiÃ³n viene de fetch/ajax, devolver JSON
    if (req.xhr || req.headers.accept?.includes('application/json')) {
      return res.json({ mensaje: 'Cliente eliminado', cliente: eliminado });
    }

    // Si es desde formulario clÃ¡sico, redirigir
    res.redirect('/clientes');
  } catch (error) {
    console.error(error);
    res
      .status(500)
      .render('error', { title: 'Error', message: 'Error al eliminar el cliente' });
  }
};

export default {
  listClientesWeb,
  showNewForm,
  showEditForm,
  showCliente,
  createClienteWeb,
  updateClienteWeb,
  deleteClienteWeb
};


=====================================================

# Archivo: controllers\empleadoController.js

// controllers/empleadoController.js

// -------------------- CONTROLADOR DE EMPLEADOS --------------------
import EmpleadoModel from '../models/EmpleadoModel.js';

// Roles y Ã¡reas vÃ¡lidos para validaciÃ³n
const ROLES = ['administrador', 'planner', 'coordinador'];
const AREAS = ['ProducciÃ³n y LogÃ­stica', 'PlanificaciÃ³n y Finanzas', 'AtenciÃ³n al Cliente', 'AdministraciÃ³n'];

// -------------------- LISTAR TODOS LOS EMPLEADOS --------------------
// GET /empleados
async function listEmpleados(req, res) {
  try {
    const empleados = await EmpleadoModel.getAll();
    res.json(empleados);
  } catch (error) {
    console.error('Error al listar empleados:', error);
    res.status(500).json({ mensaje: 'Error al obtener empleados' });
  }
}

// -------------------- OBTENER EMPLEADO POR ID --------------------
// GET /empleados/:id
async function getEmpleado(req, res) {
  try {
    const empleado = await EmpleadoModel.getById(req.params.id);
    if (!empleado) return res.status(404).json({ mensaje: 'Empleado no encontrado' });
    res.json(empleado);
  } catch (error) {
    console.error('Error al obtener empleado:', error);
    res.status(500).json({ mensaje: 'Error al obtener empleado' });
  }
}

// -------------------- CREAR NUEVO EMPLEADO --------------------
// POST /empleados
async function addEmpleado(req, res) {
  try {
    const empleado = req.body;
    if (!empleado.nombre || !empleado.rol || !empleado.area) {
      return res.status(400).json({ mensaje: 'Nombre, rol y Ã¡rea son obligatorios' });
    }
    if (!ROLES.includes(empleado.rol)) {
      return res.status(400).json({ mensaje: 'Rol invÃ¡lido' });
    }
    if (!AREAS.includes(empleado.area)) {
      return res.status(400).json({ mensaje: 'Ãrea invÃ¡lida' });
    }

    const nuevoEmpleado = await EmpleadoModel.add(empleado);
    res.status(201).json({ mensaje: 'Empleado creado', empleado: nuevoEmpleado });
  } catch (error) {
    console.error('Error al crear empleado:', error);
    res.status(500).json({ mensaje: 'Error al crear empleado' });
  }
}

// -------------------- ACTUALIZAR COMPLETAMENTE EMPLEADO --------------------
// PUT /empleados/:id
async function updateEmpleado(req, res) {
  try {
    const empleado = req.body;
    if (empleado.rol && !ROLES.includes(empleado.rol)) {
      return res.status(400).json({ mensaje: 'Rol invÃ¡lido' });
    }
    if (empleado.area && !AREAS.includes(empleado.area)) {
      return res.status(400).json({ mensaje: 'Ãrea invÃ¡lida' });
    }

    const actualizado = await EmpleadoModel.update(req.params.id, empleado);
    if (!actualizado) return res.status(404).json({ mensaje: 'Empleado no encontrado' });
    res.json({ mensaje: 'Empleado actualizado', empleado: actualizado });
  } catch (error) {
    console.error('Error al actualizar empleado:', error);
    res.status(500).json({ mensaje: 'Error al actualizar empleado' });
  }
}

// -------------------- ACTUALIZAR PARCIALMENTE EMPLEADO --------------------
// PATCH /empleados/:id
async function patchEmpleado(req, res) {
  try {
    const campos = req.body;
    if (campos.rol && !ROLES.includes(campos.rol)) {
      return res.status(400).json({ mensaje: 'Rol invÃ¡lido' });
    }
    if (campos.area && !AREAS.includes(campos.area)) {
      return res.status(400).json({ mensaje: 'Ãrea invÃ¡lida' });
    }

    const actualizado = await EmpleadoModel.patch(req.params.id, campos);
    if (!actualizado) return res.status(404).json({ mensaje: 'Empleado no encontrado' });
    res.json({ mensaje: 'Empleado actualizado parcialmente', empleado: actualizado });
  } catch (error) {
    console.error('Error al actualizar parcialmente empleado:', error);
    res.status(500).json({ mensaje: 'Error al actualizar parcialmente empleado' });
  }
}

// -------------------- ELIMINAR EMPLEADO --------------------
// DELETE /empleados/:id
async function deleteEmpleado(req, res) {
  try {
    const eliminado = await EmpleadoModel.remove(req.params.id);
    if (!eliminado) return res.status(404).json({ mensaje: 'Empleado no encontrado' });
    res.json({ mensaje: 'Empleado eliminado', empleado: eliminado });
  } catch (error) {
    console.error('Error al eliminar empleado:', error);
    res.status(500).json({ mensaje: 'Error al eliminar empleado' });
  }
}

export default { listEmpleados, getEmpleado, addEmpleado, updateEmpleado, patchEmpleado, deleteEmpleado };


=====================================================

# Archivo: controllers\EmpleadoWebController.js

// controllers/EmpleadoWebController.js
import EmpleadoModel from '../models/EmpleadoModel.js';
import TareaModel from '../models/TareaModel.js';

const EmpleadoWebController = {
  /**
   * Listar todos los empleados
   */
  async listarEmpleados(req, res) {
    try {
      const empleados = await EmpleadoModel.getAll();

      res.render('empleados/index', {
        title: 'Empleados - Eventify',
        empleados,
        currentPath: req.baseUrl || req.path
      });
    } catch (error) {
      console.error('Error al cargar empleados:', error);
      res.status(500).render('error', { 
        title: 'Error', 
        message: 'Error al cargar la lista de empleados' 
      });
    }
  },

  /**
   * Mostrar formulario para crear empleado
   */
  mostrarFormularioCrear(req, res) {
    res.render('empleados/form', {
      title: 'Nuevo Empleado - Eventify',
      formTitle: 'Nuevo Empleado',
      empleado: null,
      formAction: '/empleados/crear'
    });
  },

  /**
   * Crear empleado
   */
  async crearEmpleado(req, res) {
    try {
      const { nombre, rol, area, email, telefono } = req.body;

      if (!nombre || !rol || !area) {
        return res.render('empleados/form', {
          title: 'Nuevo Empleado - Eventify',
          formTitle: 'Nuevo Empleado',
          empleado: req.body,
          formAction: '/empleados/crear',
          error: 'Nombre, rol y Ã¡rea son obligatorios'
        });
      }

      const nuevoEmpleado = await EmpleadoModel.add({
        nombre,
        rol,
        area,
        email: email || '',
        telefono: telefono || ''
      });

      if (!nuevoEmpleado) {
        throw new Error('No se pudo crear el empleado');
      }

      res.redirect('/empleados');
    } catch (error) {
      console.error('Error al crear empleado:', error);
      res.render('empleados/form', {
        title: 'Nuevo Empleado - Eventify',
        formTitle: 'Nuevo Empleado',
        empleado: req.body,
        formAction: '/empleados/crear',
        error: 'Error al crear el empleado: ' + error.message
      });
    }
  },

  /**
   * Mostrar formulario para editar empleado
   */
  async mostrarFormularioEditar(req, res) {
    try {
      const { id } = req.params;
      
      if (!id || id === 'undefined') {
        return res.redirect('/empleados');
      }
      
      const empleado = await EmpleadoModel.getById(id);
      
      if (!empleado) {
        return res.redirect('/empleados');
      }

      res.render('empleados/form', {
        title: 'Editar Empleado - Eventify',
        formTitle: 'Editar Empleado',
        empleado: empleado,
        formAction: `/empleados/editar/${id}`
      });
    } catch (error) {
      console.error('Error al mostrar formulario de ediciÃ³n:', error);
      res.redirect('/empleados');
    }
  },

  /**
   * Actualizar empleado
   */
  async actualizarEmpleado(req, res) {
    try {
      const { id } = req.params;
      const { nombre, rol, area, email, telefono } = req.body;

      const datosActualizados = {
        nombre,
        rol,
        area,
        email: email || '',
        telefono: telefono || ''
      };

      const empleadoActualizado = await EmpleadoModel.update(id, datosActualizados);
      
      if (!empleadoActualizado) {
        throw new Error('No se pudo actualizar el empleado');
      }

      res.redirect('/empleados');
    } catch (error) {
      console.error('Error al actualizar empleado:', error);
      
      res.render('empleados/form', {
        title: 'Editar Empleado - Eventify',
        formTitle: 'Editar Empleado',
        empleado: req.body,
        formAction: `/empleados/editar/${req.params.id}`,
        error: 'Error al actualizar el empleado: ' + error.message
      });
    }
  },

  /**
   * Eliminar empleado
   */
  async eliminarEmpleado(req, res) {
    try {
      const { id } = req.params;
      
      const resultado = await EmpleadoModel.remove(id);
      
      if (!resultado) {
        throw new Error('No se pudo eliminar el empleado');
      }

      res.redirect('/empleados');
    } catch (error) {
      console.error('Error al eliminar empleado:', error);
      res.redirect('/empleados');
    }
  },

  /**
   * Mostrar detalle de un empleado y listar sus tareas asignadas
   */
  async mostrarEmpleado(req, res) {
    try {
      const { id } = req.params;
      if (!id || id === 'undefined') return res.redirect('/empleados');

      const empleado = await EmpleadoModel.getById(id);
      if (!empleado) return res.redirect('/empleados');

      // Obtener tareas y filtrar por empleado asignado
      const tareas = await TareaModel.getAll();
      const tareasAsignadas = tareas.filter(t => t.empleadoAsignado && (t.empleadoAsignado.id === empleado.id || String(t.empleadoAsignado._id) === String(empleado.id) || String(t.empleadoAsignado) === String(empleado.id)));

      res.render('empleados/show', {
        title: `Empleado - ${empleado.nombre}`,
        currentPath: '/empleados',
        empleado,
        tareas: tareasAsignadas
      });
    } catch (error) {
      console.error('Error al mostrar empleado:', error);
      res.redirect('/empleados');
    }
  }
};

export default EmpleadoWebController;

=====================================================

# Archivo: controllers\eventoController.js

// controllers/eventoController.js
// -------------------- CONTROLADOR DE EVENTOS --------------------
import EventoModel from '../models/EventoModel.js';

// -------------------- LISTAR TODOS LOS EVENTOS --------------------
// GET /eventos
async function listEventos(req, res) {
  try {
    const eventos = await EventoModel.getAll();
    res.json(eventos);
  } catch (error) {
    console.error('Error al listar eventos:', error);
    res.status(500).json({ mensaje: 'Error al obtener eventos' });
  }
}

// -------------------- OBTENER EVENTO POR ID --------------------
// GET /eventos/:id
async function getEvento(req, res) {
  try {
    const evento = await EventoModel.getById(req.params.id);
    if (!evento) return res.status(404).json({ mensaje: 'Evento no encontrado' });
    res.json(evento);
  } catch (error) {
    console.error('Error al obtener evento:', error);
    res.status(500).json({ mensaje: 'Error al obtener evento' });
  }
}

// -------------------- CREAR NUEVO EVENTO --------------------
// POST /eventos
async function addEvento(req, res) {
  try {
    const evento = req.body;
    if (!evento.nombre) {
      return res.status(400).json({ mensaje: 'El nombre del evento es obligatorio' });
    }

    const nuevoEvento = await EventoModel.add(evento);
    res.status(201).json({ mensaje: 'Evento creado', evento: nuevoEvento });
  } catch (error) {
    console.error('Error al crear evento:', error);
    res.status(500).json({ mensaje: 'Error al crear evento' });
  }
}

// -------------------- ACTUALIZAR COMPLETAMENTE EVENTO --------------------
// PUT /eventos/:id
async function updateEvento(req, res) {
  try {
    const actualizado = await EventoModel.update(req.params.id, req.body);
    if (!actualizado) return res.status(404).json({ mensaje: 'Evento no encontrado' });
    res.json({ mensaje: 'Evento actualizado', evento: actualizado });
  } catch (error) {
    console.error('Error al actualizar evento:', error);
    res.status(500).json({ mensaje: 'Error al actualizar evento' });
  }
}

// -------------------- ACTUALIZAR PARCIALMENTE EVENTO --------------------
// PATCH /eventos/:id
async function patchEvento(req, res) {
  try {
    const actualizado = await EventoModel.patch(req.params.id, req.body);
    if (!actualizado) return res.status(404).json({ mensaje: 'Evento no encontrado' });
    res.json({ mensaje: 'Evento actualizado parcialmente', evento: actualizado });
  } catch (error) {
    console.error('Error al actualizar parcialmente evento:', error);
    res.status(500).json({ mensaje: 'Error al actualizar parcialmente evento' });
  }
}

// -------------------- ELIMINAR EVENTO --------------------
// DELETE /eventos/:id
async function deleteEvento(req, res) {
  try {
    const eliminado = await EventoModel.remove(req.params.id);
    if (!eliminado) return res.status(404).json({ mensaje: 'Evento no encontrado' });
    res.json({ mensaje: 'Evento eliminado', evento: eliminado });
  } catch (error) {
    console.error('Error al eliminar evento:', error);
    res.status(500).json({ mensaje: 'Error al eliminar evento' });
  }
}

export default { listEventos, getEvento, addEvento, updateEvento, patchEvento, deleteEvento };





=====================================================

# Archivo: controllers\EventoWebController.js

import EventoModel from '../models/EventoModel.js';
import ClienteModel from '../models/ClienteModel.js';
import EmpleadoModel from '../models/EmpleadoModel.js';
import TareaModel from '../models/TareaModel.js';

const EventoWebController = {
    /**
     * Listar todos los eventos desde MongoDB
     */
    async listarEventos(req, res) {
        try {
            console.log('ðŸ” Buscando eventos en MongoDB usando EventoModel...');
            
            const eventos = await EventoModel.getAll();
            
            console.log(`Encontrados ${eventos.length} eventos`);
            
            // Transformar los datos para que coincidan con la vista
            const eventosTransformados = eventos.map(evento => ({
                _id: evento.id, // Tu modelo usa 'id' en lugar de '_id'
                nombre: evento.nombre,
                descripcion: evento.descripcion,
                fecha_inicio: evento.fechaInicio, // Transformar fechaInicio â†’ fecha_inicio
                fecha_fin: evento.fechaFin,       // Transformar fechaFin â†’ fecha_fin
                lugar: evento.lugar,
                presupuesto: evento.presupuesto,
                // Agregar tipo y estado
                tipo: evento.tipo || 'corporativo',
                estado: evento.estado || this.determinarEstado(evento.fechaInicio, evento.fechaFin),
                // Datos de las relaciones
                cliente: evento.clienteId ? (
                    typeof evento.clienteId === 'object'
                        ? { id: evento.clienteId.id || evento.clienteId._id || evento.clienteId, nombre: evento.clienteId.nombre || '', empresa: evento.clienteId.empresa || '' }
                        : { id: evento.clienteId, nombre: '', empresa: '' }
                ) : null,
                empleado: evento.empleadoId ? (
                    typeof evento.empleadoId === 'object'
                        ? { id: evento.empleadoId.id || evento.empleadoId._id || evento.empleadoId, nombre: evento.empleadoId.nombre || '', rol: evento.empleadoId.rol || '' }
                        : { id: evento.empleadoId, nombre: '', rol: '' }
                ) : null
            }));

            res.render('eventos/eventos', {
                title: 'Eventos',
                currentPath: '/eventos',
                eventos: eventosTransformados
            });

        } catch (error) {
            console.error('Error al listar eventos desde MongoDB:', error);
            
            res.render('eventos/eventos', {
                title: 'Eventos',
                currentPath: '/eventos',
                eventos: [],
                error: 'Error al cargar los eventos desde la base de datos'
            });
        }
    },

    /**
     * Mostrar formulario para crear evento
     */
    async mostrarFormularioCrear(req, res) {
        try {
            // Obtener listas de clientes y empleados
            const [clientes, empleados] = await Promise.all([
                ClienteModel.getAll(),
                EmpleadoModel.getAll()
            ]);

            res.render('eventos/crear-evento', {
                title: 'Crear Evento',
                currentPath: '/eventos',
                actionUrl: '/eventos/crear',
                evento: {},
                clientes: clientes,
                empleados: empleados,
            });
        } catch (error) {
            console.error('Error al mostrar formulario de creaciÃ³n:', error);
            res.redirect('/eventos');
        }
    },

    /**
     * Crear nuevo evento en MongoDB
     */
    async crearEvento(req, res) {
        try {
            const {
                nombre,
                descripcion,
                fecha_inicio,
                fecha_fin,
                lugar,
                precio,
                cliente_id,
                empleado_id,
                tipo,
                estado,
            } = req.body;

            // Validaciones bÃ¡sicas
            if (!nombre || !lugar) {
                return res.redirect('/eventos/crear');
            }

            // Mapear los campos del formulario a tu modelo
            const nuevoEventoData = {
                nombre: nombre,
                descripcion: descripcion || '',
                fechaInicio: fecha_inicio ? new Date(fecha_inicio) : null,
                fechaFin: fecha_fin ? new Date(fecha_fin) : null,
                lugar: lugar,
                presupuesto: precio ? parseFloat(precio) : 0,
                tipo: tipo || 'corporativo',
                estado: estado || 'pendiente',
                clienteId: cliente_id && cliente_id !== '' ? cliente_id : null,
                empleadoId: empleado_id && empleado_id !== '' ? empleado_id : null,
            };

            console.log('Creando evento con datos:', nuevoEventoData);

            // Usar el mÃ©todo add() de tu modelo personalizado
            const nuevoEvento = await EventoModel.add(nuevoEventoData);

            if (!nuevoEvento) {
                throw new Error('No se pudo crear el evento');
            }

            console.log('Evento creado en MongoDB:', nuevoEvento.id);

            res.redirect('/eventos');
            
        } catch (error) {
            console.error('Error al crear evento en MongoDB:', error);

            // Recargar clientes y empleados para mostrar el formulario nuevamente
            const [clientes, empleados] = await Promise.all([
                ClienteModel.getAll(),
                EmpleadoModel.getAll()
            ]);

            res.render('eventos/crear-evento', {
                title: 'Crear Evento',
                currentPath: '/eventos',
                actionUrl: '/eventos/crear',
                evento: req.body,
                clientes: clientes,
                empleados: empleados,
                error: 'Error al crear el evento: ' + error.message
            });
        }
    },

    /**
     * Mostrar formulario para editar evento
     */
    async mostrarFormularioEditar(req, res) {
        try {
            const { id } = req.params;
            
            console.log('Buscando evento para editar:', id);

            // Verificar que el ID sea vÃ¡lido
            if (!id || id === 'undefined') {
                console.log('ID invÃ¡lido');
                return res.redirect('/eventos');
            }
            
            const [evento, clientes, empleados] = await Promise.all([
                EventoModel.getById(id),
                ClienteModel.getAll(),
                EmpleadoModel.getAll()
            ]);

            console.log('Evento encontrado:', evento ? evento.nombre : 'No encontrado');
            
            if (!evento) {
                console.log('Evento no encontrado en la base de datos');
                return res.redirect('/eventos');
            }

            console.log('Evento encontrado:', evento.nombre);

            // Transformar los datos para el formulario
            const eventoTranformado = {
                _id: evento.id,
                nombre: evento.nombre,
                descripcion: evento.descripcion,
                fecha_inicio: evento.fechaInicio,
                fecha_fin: evento.fechaFin,
                lugar: evento.lugar,
                precio: evento.presupuesto,
                tipo: evento.tipo || 'corporativo',
                estado: evento.estado || 'pendiente',
                cliente_id: evento.clienteId ? (evento.clienteId.id || evento.clienteId) : '',
                empleado_id: evento.empleadoId ? (evento.empleadoId.id || evento.empleadoId) : ''
            };

            res.render('eventos/editar-evento', {
                title: 'Editar Evento',
                currentPath: '/eventos',
                evento: eventoTranformado,
                clientes: clientes,
                empleados: empleados,
                actionUrl: `/eventos/editar/${id}`
            });
        } catch (error) {
            console.error('Error al mostrar formulario de ediciÃ³n:', error);
            res.redirect('/eventos');
        }
    },

    /**
     * Actualizar evento existente en MongoDB
     */
    async actualizarEvento(req, res) {
        try {
            const { id } = req.params;
            const {
                nombre,
                descripcion,
                fecha_inicio,
                fecha_fin,
                lugar,
                precio,
                cliente_id,
                empleado_id,
                tipo,
                estado,
            } = req.body;

            console.log('Actualizando evento:', id);

            // Mapear los campos del formulario a tu modelo
            const datosActualizados = {
                nombre: nombre,
                descripcion: descripcion || '',
                fechaInicio: fecha_inicio ? new Date(fecha_inicio) : null,
                fechaFin: fecha_fin ? new Date(fecha_fin) : null,
                lugar: lugar,
                presupuesto: precio ? parseFloat(precio) : 0,
                tipo: tipo || 'corporativo',
                estado: estado || 'pendiente',
                clienteId: cliente_id || null,
                empleadoId: empleado_id || null,
            };

            // Usar el mÃ©todo update() de tu modelo personalizado
            const eventoActualizado = await EventoModel.update(id, datosActualizados);
            
            if (!eventoActualizado) {
                throw new Error('No se pudo actualizar el evento');
            }

            console.log('Evento actualizado en MongoDB:', id);

            res.redirect('/eventos');
            
        } catch (error) {
            console.error('Error al actualizar evento en MongoDB:', error);

            // Recargar datos para mostrar el formulario con error
            const [clientes, empleados] = await Promise.all([
                ClienteModel.getAll(),
                EmpleadoModel.getAll()
            ]);
            
            res.render('eventos/editar-evento', {
                title: 'Editar Evento',
                currentPath: '/eventos',
                evento: req.body,
                clientes: clientes,
                empleados: empleados,
                actionUrl: `/eventos/editar/${req.params.id}`,
                error: 'Error al actualizar el evento: ' + error.message
            });
        }
    },

    /**
     * Eliminar evento de MongoDB
     */
    async eliminarEvento(req, res) {
        try {
            const { id } = req.params;
            
            console.log('Eliminando evento:', id);
            
            // Usar el mÃ©todo remove() de tu modelo personalizado
            const resultado = await EventoModel.remove(id);
            
            if (!resultado) {
                throw new Error('No se pudo eliminar el evento');
            }

            console.log('Evento eliminado de MongoDB:', id);

            res.redirect('/eventos');
            
        } catch (error) {
            console.error('Error al eliminar evento de MongoDB:', error);
            res.redirect('/eventos');
        }
    },

    determinarEstado(fechaInicio, fechaFin) {
        if (!fechaInicio) return 'pendiente';
        
        const ahora = new Date();
        const inicio = new Date(fechaInicio);
        const fin = fechaFin ? new Date(fechaFin) : null;
        
        if (fin && fin < ahora) return 'finalizado';
        if (inicio > ahora) return 'pendiente';
        if (inicio <= ahora && (!fin || fin >= ahora)) return 'activo';
        
        return 'activo';
    },

    /**
     * Mostrar detalle de un solo evento (vista)
     */
    async mostrarEvento(req, res) {
        try {
            const { id } = req.params;
            if (!id || id === 'undefined') return res.redirect('/eventos');

            const evento = await EventoModel.getById(id);
            if (!evento) return res.redirect('/eventos');

            // Preparar datos para la vista
            // Si no hay empleado directo en el evento, intentamos inferirlo desde las tareas relacionadas
            let empleadoInferido = null;
            if (!evento.empleadoId) {
                try {
                    const tareas = await TareaModel.getAll();
                    const tareaConEmp = tareas.find(t => {
                        const evId = t.eventoAsignado && (t.eventoAsignado.id || t.eventoAsignado);
                        return String(evId) === String(evento.id) && t.empleadoAsignado;
                    });
                    if (tareaConEmp) {
                        const emp = tareaConEmp.empleadoAsignado;
                        empleadoInferido = typeof emp === 'object'
                            ? { id: emp.id || emp._id || emp, nombre: emp.nombre || '', rol: emp.rol || '' }
                            : { id: emp, nombre: '', rol: '' };
                    }
                } catch (e) {
                    console.error('Error al inferir empleado desde tareas:', e);
                }
            }

            const eventoView = {
                id: evento.id,
                nombre: evento.nombre,
                descripcion: evento.descripcion,
                fechaInicio: evento.fechaInicio,
                fechaFin: evento.fechaFin,
                lugar: evento.lugar,
                presupuesto: evento.presupuesto,
                tipo: evento.tipo,
                estado: evento.estado || this.determinarEstado(evento.fechaInicio, evento.fechaFin),
                cliente: evento.clienteId ? (
                    typeof evento.clienteId === 'object'
                        ? { id: evento.clienteId.id || evento.clienteId._id || evento.clienteId, nombre: evento.clienteId.nombre || '', empresa: evento.clienteId.empresa || '' }
                        : { id: evento.clienteId, nombre: '', empresa: '' }
                ) : null,
                // Priorizar empleado directamente asignado; si no existe, usar el inferido desde tareas
                empleado: evento.empleadoId ? (
                    typeof evento.empleadoId === 'object'
                        ? { id: evento.empleadoId.id || evento.empleadoId._id || evento.empleadoId, nombre: evento.empleadoId.nombre || '', rol: evento.empleadoId.rol || '' }
                        : { id: evento.empleadoId, nombre: '', rol: '' }
                ) : (empleadoInferido || null)
            };

            res.render('eventos/show', {
                title: `Evento - ${eventoView.nombre}`,
                currentPath: '/eventos',
                evento: eventoView
            });
        } catch (error) {
            console.error('Error al mostrar evento:', error);
            res.redirect('/eventos');
        }
    }
};

export default EventoWebController;



=====================================================

# Archivo: controllers\tareaController.js

// controllers/tareaController.js
// -------------------- CONTROLADOR DE TAREAS --------------------
import TareaModel from '../models/TareaModel.js';

// -------------------- ÃREAS Y TIPOS DE TAREAS --------------------
const AREAS = {
  "ProducciÃ³n y LogÃ­stica": [
    "CoordinaciÃ³n con proveedores",
    "Montaje de escenario o mobiliario",
    "VerificaciÃ³n tÃ©cnica previa al evento"
  ],
  "PlanificaciÃ³n y Finanzas": [
    "Carga y control del presupuesto del evento",
    "Firma de contratos con clientes/proveedores",
    "Seguimiento del cronograma y fechas clave"
  ]
};

// -------------------- LISTAR Y FILTRAR TAREAS --------------------
async function listTareas(req, res) {
  try {
    const { estado, prioridad, fechaInicio, fechaFin, empleadoAsignado, eventoAsignado } = req.query;
    let tareas = await TareaModel.getAll();

    if (estado) tareas = tareas.filter(t => t.estado === estado);
    if (prioridad) tareas = tareas.filter(t => t.prioridad === prioridad);
    if (empleadoAsignado) tareas = tareas.filter(t => String(t.empleadoAsignado?._id) === String(empleadoAsignado));
    if (eventoAsignado) tareas = tareas.filter(t => String(t.eventoAsignado?._id) === String(eventoAsignado));

    if (fechaInicio && fechaFin) {
      const inicio = new Date(fechaInicio);
      const fin = new Date(fechaFin);
      tareas = tareas.filter(t => t.fechaInicio && t.fechaFin && t.fechaInicio >= inicio && t.fechaFin <= fin);
    }

    res.json(tareas);
  } catch (error) {
    console.error('Error al listar tareas:', error);
    res.status(500).json({ mensaje: 'Error al obtener tareas' });
  }
}

// -------------------- OBTENER UNA TAREA POR ID --------------------
async function getTarea(req, res) {
  try {
    const tarea = await TareaModel.getById(req.params.id);
    if (!tarea) return res.status(404).json({ mensaje: 'Tarea no encontrada' });
    res.json(tarea);
  } catch (error) {
    console.error('Error al obtener tarea:', error);
    res.status(500).json({ mensaje: 'Error al obtener tarea' });
  }
}

// -------------------- CREAR NUEVA TAREA --------------------
async function addTarea(req, res) {
  try {
    const tarea = req.body;
    if (tarea.area && tarea.tipo) {
      const tipos = AREAS[tarea.area];
      if (!tipos || !tipos.includes(tarea.tipo)) {
        return res.status(400).json({ mensaje: `Tarea invÃ¡lida para el Ã¡rea ${tarea.area}` });
      }
    }

    const nuevaTarea = await TareaModel.add(tarea);
    res.status(201).json({ mensaje: 'Tarea creada', tarea: nuevaTarea });
  } catch (error) {
    console.error('Error al crear tarea:', error);
    res.status(500).json({ mensaje: 'Error al crear tarea' });
  }
}

// -------------------- ACTUALIZAR COMPLETAMENTE (PUT) --------------------
async function updateTarea(req, res) {
  try {
    const tarea = req.body;
    const id = req.params.id;
    if (tarea.area && tarea.tipo) {
      const tipos = AREAS[tarea.area];
      if (!tipos || !tipos.includes(tarea.tipo)) {
        return res.status(400).json({ mensaje: `Tarea invÃ¡lida para el Ã¡rea ${tarea.area}` });
      }
    }
    const actualizada = await TareaModel.update(id, tarea);
    if (!actualizada) return res.status(404).json({ mensaje: 'Tarea no encontrada' });
    res.json({ mensaje: 'Tarea actualizada', tarea: actualizada });
  } catch (error) {
    console.error('Error al actualizar tarea:', error);
    res.status(500).json({ mensaje: 'Error al actualizar tarea' });
  }
}

// -------------------- ACTUALIZAR PARCIALMENTE (PATCH) --------------------
async function patchTarea(req, res) {
  try {
    const campos = req.body;
    const id = req.params.id;
    if (campos.area && campos.tipo) {
      const tipos = AREAS[campos.area];
      if (!tipos || !tipos.includes(campos.tipo)) {
        return res.status(400).json({ mensaje: `Tarea invÃ¡lida para el Ã¡rea ${campos.area}` });
      }
    }
    const actualizada = await TareaModel.patch(id, campos);
    if (!actualizada) return res.status(404).json({ mensaje: 'Tarea no encontrada' });
    res.json({ mensaje: 'Tarea actualizada parcialmente', tarea: actualizada });
  } catch (error) {
    console.error('Error al actualizar tarea parcialmente:', error);
    res.status(500).json({ mensaje: 'Error al actualizar tarea parcialmente' });
  }
}

// -------------------- ELIMINAR TAREA --------------------
async function deleteTarea(req, res) {
  try {
    const eliminada = await TareaModel.remove(req.params.id);
    if (!eliminada) return res.status(404).json({ mensaje: 'Tarea no encontrada' });
    res.json({ mensaje: 'Tarea eliminada', tarea: eliminada });
  } catch (error) {
    console.error('Error al eliminar tarea:', error);
    res.status(500).json({ mensaje: 'Error al eliminar tarea' });
  }
}

export default { listTareas, getTarea, addTarea, updateTarea, patchTarea, deleteTarea };


=====================================================

# Archivo: controllers\TareaWebController.js

// controllers/TareaWebController.js
import TareaModel from '../models/TareaModel.js';
import EmpleadoModel from '../models/EmpleadoModel.js';
import EventoModel from '../models/EventoModel.js';

const TareaWebController = {
  /**
   * Listar todas las tareas
   */
  async listarTareas(req, res) {
    try {
      const tareas = await TareaModel.getAll();

      res.render('tareas/index', {
        title: 'Tareas - Eventify',
        tareas,
        currentPath: req.baseUrl || req.path
      });
    } catch (error) {
      console.error('Error al cargar tareas:', error);
      res.status(500).render('error', { 
        title: 'Error', 
        message: 'Error al cargar la lista de tareas' 
      });
    }
  },

  /**
   * Mostrar formulario para crear tarea
   */
  async mostrarFormularioCrear(req, res) {
    try {
      const [empleados, eventos] = await Promise.all([
        EmpleadoModel.getAll(),
        EventoModel.getAll()
      ]);

      res.render('tareas/form', {
        title: 'Nueva Tarea - Eventify',
        formTitle: 'Nueva Tarea',
        tarea: null,
        formAction: '/tareas/crear',
        empleados,
        eventos
      });
    } catch (error) {
      console.error('Error al mostrar formulario:', error);
      res.redirect('/tareas');
    }
  },

  /**
   * Crear tarea
   */
  async crearTarea(req, res) {
    try {
      const {
        titulo,
        descripcion,
        estado,
        fechaInicio,
        fechaFin,
        prioridad,
        area,
        tipo,
        empleadoAsignado,
        eventoAsignado,
        horasEstimadas,
        horasReales
      } = req.body;

      if (!titulo || !area || !tipo) {
        const [empleados, eventos] = await Promise.all([
          EmpleadoModel.getAll(),
          EventoModel.getAll()
        ]);

        return res.render('tareas/form', {
          title: 'Nueva Tarea - Eventify',
          formTitle: 'Nueva Tarea',
          tarea: req.body,
          formAction: '/tareas/crear',
          empleados,
          eventos,
          error: 'TÃ­tulo, Ã¡rea y tipo son obligatorios'
        });
      }

      const nuevaTarea = await TareaModel.add({
        titulo,
        descripcion: descripcion || '',
        estado: estado || 'pendiente',
        fechaInicio: fechaInicio ? new Date(fechaInicio) : null,
        fechaFin: fechaFin ? new Date(fechaFin) : null,
        prioridad: prioridad || 'media',
        area,
        tipo,
        empleadoAsignado: empleadoAsignado || null,
        eventoAsignado: eventoAsignado || null,
        horasEstimadas: horasEstimadas ? parseInt(horasEstimadas) : 0,
        horasReales: horasReales ? parseInt(horasReales) : 0
      });

      if (!nuevaTarea) {
        throw new Error('No se pudo crear la tarea');
      }

      res.redirect('/tareas');
    } catch (error) {
      console.error('Error al crear tarea:', error);
      
      const [empleados, eventos] = await Promise.all([
        EmpleadoModel.getAll(),
        EventoModel.getAll()
      ]);

      res.render('tareas/form', {
        title: 'Nueva Tarea - Eventify',
        formTitle: 'Nueva Tarea',
        tarea: req.body,
        formAction: '/tareas/crear',
        empleados,
        eventos,
        error: 'Error al crear la tarea: ' + error.message
      });
    }
  },

  /**
   * Mostrar formulario para editar tarea
   */
  async mostrarFormularioEditar(req, res) {
    try {
      const { id } = req.params;
      
      if (!id || id === 'undefined') {
        return res.redirect('/tareas');
      }
      
      const [tarea, empleados, eventos] = await Promise.all([
        TareaModel.getById(id),
        EmpleadoModel.getAll(),
        EventoModel.getAll()
      ]);
      
      if (!tarea) {
        return res.redirect('/tareas');
      }

      res.render('tareas/form', {
        title: 'Editar Tarea - Eventify',
        formTitle: 'Editar Tarea',
        tarea: tarea,
        formAction: `/tareas/editar/${id}`,
        empleados,
        eventos
      });
    } catch (error) {
      console.error('Error al mostrar formulario de ediciÃ³n:', error);
      res.redirect('/tareas');
    }
  },

  /**
   * Actualizar tarea
   */
  async actualizarTarea(req, res) {
    try {
      const { id } = req.params;
      const {
        titulo,
        descripcion,
        estado,
        fechaInicio,
        fechaFin,
        prioridad,
        area,
        tipo,
        empleadoAsignado,
        eventoAsignado,
        horasEstimadas,
        horasReales
      } = req.body;

      const datosActualizados = {
        titulo,
        descripcion: descripcion || '',
        estado: estado || 'pendiente',
        fechaInicio: fechaInicio ? new Date(fechaInicio) : null,
        fechaFin: fechaFin ? new Date(fechaFin) : null,
        prioridad: prioridad || 'media',
        area,
        tipo,
        empleadoAsignado: empleadoAsignado || null,
        eventoAsignado: eventoAsignado || null,
        horasEstimadas: horasEstimadas ? parseInt(horasEstimadas) : 0,
        horasReales: horasReales ? parseInt(horasReales) : 0
      };

      const tareaActualizada = await TareaModel.update(id, datosActualizados);
      
      if (!tareaActualizada) {
        throw new Error('No se pudo actualizar la tarea');
      }

      res.redirect('/tareas');
    } catch (error) {
      console.error('Error al actualizar tarea:', error);
      
      const [empleados, eventos] = await Promise.all([
        EmpleadoModel.getAll(),
        EventoModel.getAll()
      ]);

      res.render('tareas/form', {
        title: 'Editar Tarea - Eventify',
        formTitle: 'Editar Tarea',
        tarea: req.body,
        formAction: `/tareas/editar/${req.params.id}`,
        empleados,
        eventos,
        error: 'Error al actualizar la tarea: ' + error.message
      });
    }
  },

  /**
   * Eliminar tarea
   */
  async eliminarTarea(req, res) {
    try {
      const { id } = req.params;
      
      const resultado = await TareaModel.remove(id);
      
      if (!resultado) {
        throw new Error('No se pudo eliminar la tarea');
      }

      res.redirect('/tareas');
    } catch (error) {
      console.error('Error al eliminar tarea:', error);
      res.redirect('/tareas');
    }
    },

  /**
   * Mostrar detalle de una tarea (vista)
   */
  async mostrarTarea(req, res) {
    try {
      const { id } = req.params;
      if (!id || id === 'undefined') return res.redirect('/tareas');

      const tarea = await TareaModel.getById(id);
      if (!tarea) return res.redirect('/tareas');

      res.render('tareas/show', {
        title: `Tarea - ${tarea.titulo}`,
        currentPath: '/tareas',
        tarea
      });
    } catch (error) {
      console.error('Error al mostrar tarea:', error);
      res.redirect('/tareas');
    }
  }
};

export default TareaWebController;

=====================================================

# Archivo: db\mongoose.js

// db/mongoose.js
import mongoose from 'mongoose';
import 'dotenv/config'; // Carga variables de entorno desde el archivo .env

export async function connectMongo(uri = process.env.MONGODB_URI) {
  if (!uri) {
    throw new Error('Falta MONGODB_URI en el .env');
  }

  try {
    mongoose.set('strictQuery', true);

    await mongoose.connect(uri, {
      serverSelectionTimeoutMS: 10000,
    });

    const dbName = mongoose.connection.name;
    console.log(`Conectado a MongoDB (${dbName})`);

    // Escuchar eventos del estado de la conexiÃ³n
    mongoose.connection.on('disconnected', () => {
      console.warn('Se perdiÃ³ la conexiÃ³n con MongoDB');
    });

    mongoose.connection.on('reconnected', () => {
      console.log('Reconectado a MongoDB');
    });
  } catch (error) {
    console.error('Error al conectar con MongoDB:', error.message);
    // En tests es mejor lanzar el error en vez de matar el proceso
    throw error;
  }
}

export async function disconnectMongo() {
  try {
    await mongoose.disconnect();
    console.log('ConexiÃ³n con MongoDB cerrada');
  } catch (error) {
    console.error('Error al desconectarse de MongoDB:', error.message);
  }
}


=====================================================

# Archivo: middleware\auth.js

// middleware/auth.js
import jwt from 'jsonwebtoken';
import UsuarioModel from '../models/UsuarioModel.js';

// Generar Token JWT
export function generarToken(userId) {
  const secret = process.env.JWT_SECRET || 'eventify-test-secret';
  if (!process.env.JWT_SECRET) console.warn('JWT_SECRET no definido. Usando secreto por defecto de desarrollo.');
  return jwt.sign(
    { id: userId },
    secret,
    { expiresIn: process.env.JWT_EXPIRES_IN || '7d' }
  );
}

// Middleware: Verificar que el usuario estÃ© autenticado
export async function verificarAuth(req, res, next) {
  try {
    // 1. Obtener token de las cookies o del header
    const token = req.cookies?.token || req.headers.authorization?.replace('Bearer ', '');

    if (!token) {
      return res.status(401).render('auth/login', {
        title: 'Acceso Denegado',
        error: 'Debes iniciar sesiÃ³n para acceder a esta pÃ¡gina'
      });
    }

    // 2. Verificar token
    const secret = process.env.JWT_SECRET || 'eventify-test-secret';
    const decoded = jwt.verify(token, secret);

    // 3. Buscar usuario
    const usuario = await UsuarioModel.getById(decoded.id);
    if (!usuario) {
      return res.status(401).render('auth/login', {
        title: 'Acceso Denegado',
        error: 'Usuario no encontrado'
      });
    }

    // 4. Agregar usuario a la request
    req.usuario = usuario;
    res.locals.usuario = usuario; // Para usarlo en las vistas
    next();
  } catch (error) {
    console.error('Error de autenticaciÃ³n:', error);
    return res.status(401).render('auth/login', {
      title: 'Acceso Denegado',
      error: 'Token invÃ¡lido o expirado'
    });
  }
}

// Middleware: Verificar roles especÃ­ficos
export function verificarRol(...rolesPermitidos) {
  return (req, res, next) => {
    if (!req.usuario) {
      return res.status(401).json({ mensaje: 'No autenticado' });
    }

    if (!rolesPermitidos.includes(req.usuario.rol)) {
      return res.status(403).render('error', {
        title: 'Acceso Denegado',
        message: `Solo usuarios con rol ${rolesPermitidos.join(' o ')} pueden acceder`
      });
    }

    next();
  };
}

=====================================================

# Archivo: models\ClienteModel.js

//
// -------------------- MODELO DE CLIENTE --------------------
import mongoose from 'mongoose';

// -------------------- CONFIGURACIÃ“N DEL ESQUEMA --------------------
// Define la estructura de los documentos en la colecciÃ³n "clientes".
const ClienteSchema = new mongoose.Schema(
  {
    nombre: { type: String, required: true, trim: true },
    email: { type: String, required: true, lowercase: true, trim: true },
    telefono: { type: String, trim: true },
    empresa: { type: String, trim: true },
    notas: { type: String, trim: true },
  },
  { timestamps: true }
);

// -------------------- MODELO --------------------
const Cliente = mongoose.models.Cliente || mongoose.model('Cliente', ClienteSchema);

// -------------------- FUNCIÃ“N AUXILIAR --------------------
function toPlain(doc) {
  if (!doc) return null;
  const obj = doc.toObject({ versionKey: false });
  obj.id = String(obj._id);
  return obj;
}

// -------------------- CRUD --------------------
class ClienteModel {
  async getAll() {
    try {
      const clientes = await Cliente.find().sort({ createdAt: -1 });
      return clientes.map(toPlain);
    } catch (error) {
      console.error('Error al obtener los clientes:', error);
      return [];
    }
  }

  async getById(id) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const cliente = await Cliente.findById(id);
      return toPlain(cliente);
    } catch (error) {
      console.error('Error al obtener cliente por ID:', error);
      return null;
    }
  }

  async add(cliente) {
    try {
      const nuevo = await Cliente.create({
        nombre: cliente.nombre,
        email: cliente.email,
        telefono: cliente.telefono || '',
        empresa: cliente.empresa || '',
        notas: cliente.notas || '',
      });
      return toPlain(nuevo);
    } catch (error) {
      console.error('Error al agregar cliente:', error);
      return null;
    }
  }

  async update(id, cliente) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const actualizado = await Cliente.findByIdAndUpdate(id, cliente, {
        new: true,
        runValidators: true,
      });
      return actualizado ? toPlain(actualizado) : null;
    } catch (error) {
      console.error('Error al actualizar cliente:', error);
      return null;
    }
  }

  async patch(id, campos) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const actualizado = await Cliente.findByIdAndUpdate(
        id,
        { $set: campos },
        { new: true, runValidators: true }
      );
      return actualizado ? toPlain(actualizado) : null;
    } catch (error) {
      console.error('Error al actualizar parcialmente cliente:', error);
      return null;
    }
  }

  async remove(id) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const eliminado = await Cliente.findByIdAndDelete(id);
      return eliminado ? toPlain(eliminado) : null;
    } catch (error) {
      console.error('Error al eliminar cliente:', error);
      return null;
    }
  }
}

export default new ClienteModel();


=====================================================

# Archivo: models\EmpleadoModel.js

//
// -------------------- MODELO DE EMPLEADO --------------------
import mongoose from 'mongoose';

// -------------------- CONFIGURACIÃ“N DEL ESQUEMA --------------------
const EmpleadoSchema = new mongoose.Schema(
  {
    nombre: { type: String, required: true, trim: true },
    rol: {
      type: String,
      enum: ['administrador', 'planner', 'coordinador'],
      required: true,
    },
    area: {
      type: String,
      enum: ['ProducciÃ³n y LogÃ­stica', 'PlanificaciÃ³n y Finanzas', 'AtenciÃ³n al Cliente', 'AdministraciÃ³n'],
      required: true,
    },
    email: { type: String, lowercase: true, trim: true },
    telefono: { type: String, trim: true },
  },
  { timestamps: true }
);

// -------------------- MODELO --------------------
const Empleado = mongoose.models.Empleado || mongoose.model('Empleado', EmpleadoSchema);

// -------------------- FUNCIÃ“N AUXILIAR --------------------
function toPlain(doc) {
  if (!doc) return null;
  const obj = doc.toObject({ versionKey: false });
  obj.id = String(obj._id);
  return obj;
}

// -------------------- CRUD --------------------
class EmpleadoModel {
  async getAll() {
    try {
      const empleados = await Empleado.find().sort({ createdAt: -1 });
      return empleados.map(toPlain);
    } catch (error) {
      console.error('Error al obtener los empleados:', error);
      return [];
    }
  }

  async getById(id) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const empleado = await Empleado.findById(id);
      return toPlain(empleado);
    } catch (error) {
      console.error('Error al obtener empleado por ID:', error);
      return null;
    }
  }

  async add(empleado) {
    try {
      const nuevo = await Empleado.create({
        nombre: empleado.nombre,
        rol: empleado.rol,
        area: empleado.area,
        email: empleado.email || '',
        telefono: empleado.telefono || '',
      });
      return toPlain(nuevo);
    } catch (error) {
      console.error('Error al agregar empleado:', error);
      return null;
    }
  }

  async update(id, empleado) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const actualizado = await Empleado.findByIdAndUpdate(id, empleado, {
        new: true,
        runValidators: true,
      });
      return actualizado ? toPlain(actualizado) : null;
    } catch (error) {
      console.error('Error al actualizar empleado:', error);
      return null;
    }
  }

  async patch(id, campos) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const actualizado = await Empleado.findByIdAndUpdate(
        id,
        { $set: campos },
        { new: true, runValidators: true }
      );
      return actualizado ? toPlain(actualizado) : null;
    } catch (error) {
      console.error('Error al actualizar parcialmente empleado:', error);
      return null;
    }
  }

  async remove(id) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const eliminado = await Empleado.findByIdAndDelete(id);
      return eliminado ? toPlain(eliminado) : null;
    } catch (error) {
      console.error('Error al eliminar empleado:', error);
      return null;
    }
  }
}

export default new EmpleadoModel();


=====================================================

# Archivo: models\EventoModel.js

//
// -------------------- MODELO DE EVENTO --------------------
import mongoose from 'mongoose';

// -------------------- CONFIGURACIÃ“N DEL ESQUEMA --------------------
const EventoSchema = new mongoose.Schema(
  {
    nombre: { type: String, required: true, trim: true },
    descripcion: { type: String, trim: true },
    fechaInicio: { type: Date, required: true },
    fechaFin: { type: Date, required: true },
    lugar: { type: String, trim: true },
    presupuesto: { type: Number, default: 0 },
    // Nuevos campos Tipo y Estado
    tipo: { 
      type: String, 
      enum: ['conferencia', 'workshop', 'networking', 'social', 'deportivo', 'cultural', 'educativo', 'corporativo'],
      default: 'corporativo'
    },
    estado: { 
      type: String, 
      enum: ['activo', 'pendiente', 'cancelado', 'finalizado'],
      default: 'pendiente'
    },
    // Nuevos campos para relaciones
    clienteId: { 
      type: mongoose.Schema.Types.ObjectId, 
      ref: 'Cliente',
      required: false 
    },
    empleadoId: { 
      type: mongoose.Schema.Types.ObjectId, 
      ref: 'Empleado',
      required: false 
    }
  },
  { timestamps: true }
);

// -------------------- MODELO --------------------
const Evento = mongoose.models.Evento || mongoose.model('Evento', EventoSchema);

// -------------------- FUNCIÃ“N AUXILIAR --------------------
function toPlain(doc) {
  if (!doc) return null;
  const obj = doc.toObject({ versionKey: false });
  obj.id = String(obj._id);
  
  if (obj.clienteId && typeof obj.clienteId === 'object') {
    obj.clienteIdString = String(obj.clienteId._id || obj.clienteId);
  }
  if (obj.empleadoId && typeof obj.empleadoId === 'object') {
    obj.empleadoIdString = String(obj.empleadoId._id || obj.empleadoId);
  }
  
  return obj;
}

// -------------------- CRUD --------------------
class EventoModel {
  async getAll() {
    try {
      let query = Evento.find().sort({ createdAt: -1 });
      const registered = mongoose.modelNames ? mongoose.modelNames() : Object.keys(mongoose.models || {});
      if (registered.includes('Cliente')) {
        query = query.populate('clienteId', 'nombre email telefono empresa');
      }
      if (registered.includes('Empleado')) {
        query = query.populate('empleadoId', 'nombre rol area');
      }
      const eventos = await query;
      return eventos.map(toPlain);
    } catch (error) {
      console.error('Error al obtener los eventos:', error);
      return [];
    }
  }

  async getById(id) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      let query = Evento.findById(id);
      const registered = mongoose.modelNames ? mongoose.modelNames() : Object.keys(mongoose.models || {});
      if (registered.includes('Cliente')) {
        query = query.populate('clienteId', 'nombre email telefono empresa');
      }
      if (registered.includes('Empleado')) {
        query = query.populate('empleadoId', 'nombre rol area');
      }
      const evento = await query;
      return evento ? toPlain(evento) : null;
    } catch (error) {
      console.error('Error al obtener evento por ID:', error);
      return null;
    }
  }

  async add(evento) {
    try {
      // Normalizar fechas: intentar convertir a Date y proveer valores por defecto
      let fechaInicio = evento.fechaInicio ? new Date(evento.fechaInicio) : null;
      let fechaFin = evento.fechaFin ? new Date(evento.fechaFin) : null;

      if (!fechaInicio) {
        fechaInicio = new Date();
      }
      if (!fechaFin) {
        // Por defecto, 1 dÃ­a despuÃ©s de inicio
        fechaFin = new Date(fechaInicio.getTime() + 24 * 60 * 60 * 1000);
      }

      const nuevo = await Evento.create({
        nombre: evento.nombre,
        descripcion: evento.descripcion || '',
        fechaInicio,
        fechaFin,
        lugar: evento.lugar || '',
        presupuesto: Number(evento.presupuesto) || 0,
        tipo: evento.tipo || 'corporativo',
        estado: evento.estado || 'pendiente',
        clienteId: evento.clienteId || null,
        empleadoId: evento.empleadoId || null,
      });

      // Repopular para obtener los datos relacionados
      let query = Evento.findById(nuevo._id);
      const registered = mongoose.modelNames ? mongoose.modelNames() : Object.keys(mongoose.models || {});
      if (registered.includes('Cliente')) {
        query = query.populate('clienteId', 'nombre email telefono empresa');
      }
      if (registered.includes('Empleado')) {
        query = query.populate('empleadoId', 'nombre rol area');
      }
      const eventoPopulado = await query;
      return toPlain(eventoPopulado);
    } catch (error) {
      console.error('Error al agregar evento:', error);
      try {
        process.stderr.write(`EVENTO_ADD_ERROR: ${error.stack || error}\n`);
      } catch (e) {
        // ignore
      }
      return null;
    }
  }

  async update(id, evento) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      let query = Evento.findByIdAndUpdate(id, evento, {
        new: true,
        runValidators: true,
      });
      const registered = mongoose.modelNames ? mongoose.modelNames() : Object.keys(mongoose.models || {});
      if (registered.includes('Cliente')) {
        query = query.populate('clienteId', 'nombre email telefono empresa');
      }
      if (registered.includes('Empleado')) {
        query = query.populate('empleadoId', 'nombre rol area');
      }
      const actualizado = await query;
      return actualizado ? toPlain(actualizado) : null;
    } catch (error) {
      console.error('Error al actualizar evento:', error);
      return null;
    }
  }

  async patch(id, campos) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      let query = Evento.findByIdAndUpdate(
        id,
        { $set: campos },
        { new: true, runValidators: true }
      );
      const registered = mongoose.modelNames ? mongoose.modelNames() : Object.keys(mongoose.models || {});
      if (registered.includes('Cliente')) {
        query = query.populate('clienteId', 'nombre email telefono empresa');
      }
      if (registered.includes('Empleado')) {
        query = query.populate('empleadoId', 'nombre rol area');
      }
      const actualizado = await query;
      return actualizado ? toPlain(actualizado) : null;
    } catch (error) {
      console.error('Error al actualizar parcialmente evento:', error);
      return null;
    }
  }

  async remove(id) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const eliminado = await Evento.findByIdAndDelete(id);
      return eliminado ? toPlain(eliminado) : null;
    } catch (error) {
      console.error('Error al eliminar evento:', error);
      return null;
    }
  }
}

export default new EventoModel();





=====================================================

# Archivo: models\TareaModel.js

//
// -------------------- MODELO DE TAREA --------------------
import mongoose from 'mongoose';

// -------------------- CONFIGURACIÃ“N DEL ESQUEMA --------------------
// Define la estructura de los documentos en la colecciÃ³n "tareas".
const TareaSchema = new mongoose.Schema(
  {
    titulo: { type: String, required: true, trim: true },
    descripcion: { type: String, trim: true },
    estado: {
      type: String,
      enum: ['pendiente', 'en proceso', 'finalizada'],
      default: 'pendiente',
    },
    fechaInicio: { type: Date },
    fechaFin: { type: Date },
    prioridad: {
      type: String,
      enum: ['baja', 'media', 'alta'],
      default: 'media',
    },
    area: {
      type: String,
      enum: ['ProducciÃ³n y LogÃ­stica', 'PlanificaciÃ³n y Finanzas'],
      required: true,
    },
    tipo: { type: String, trim: true, required: true },
    empleadoAsignado: { type: mongoose.Schema.Types.ObjectId, ref: 'Empleado' },
    eventoAsignado: { type: mongoose.Schema.Types.ObjectId, ref: 'Evento' },
    horasEstimadas: { type: Number, default: 0 },
    horasReales: { type: Number, default: 0 },
  },
  { timestamps: true }
);

// -------------------- MODELO --------------------
const Tarea = mongoose.models.Tarea || mongoose.model('Tarea', TareaSchema);

// -------------------- FUNCIÃ“N AUXILIAR --------------------
function toPlain(doc) {
  if (!doc) return null;
  const obj = doc.toObject({ versionKey: false });
  obj.id = String(obj._id);
  return obj;
}

// -------------------- CRUD --------------------
class TareaModel {
  async getAll() {
    try {
      const tareas = await Tarea.find()
        .sort({ createdAt: -1 })
        .populate('empleadoAsignado', 'nombre rol area email')
        .populate('eventoAsignado', 'nombre lugar descripcion');
      return tareas.map(toPlain);
    } catch (error) {
      console.error('Error al obtener las tareas:', error);
      return [];
    }
  }

  async getById(id) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const tarea = await Tarea.findById(id)
        .populate('empleadoAsignado', 'nombre rol area email')
        .populate('eventoAsignado', 'nombre lugar descripcion');
      return toPlain(tarea);
    } catch (error) {
      console.error('Error al obtener tarea por ID:', error);
      return null;
    }
  }

  async add(tarea) {
    try {
      const nueva = await Tarea.create({
        titulo: tarea.titulo,
        descripcion: tarea.descripcion || '',
        estado: tarea.estado || 'pendiente',
        fechaInicio: tarea.fechaInicio || null,
        fechaFin: tarea.fechaFin || null,
        prioridad: tarea.prioridad || 'media',
        area: tarea.area,
        tipo: tarea.tipo,
        empleadoAsignado: tarea.empleadoAsignado || null,
        eventoAsignado: tarea.eventoAsignado || null,
        horasEstimadas: Number(tarea.horasEstimadas) || 0,
        horasReales: Number(tarea.horasReales) || 0,
      });
      return toPlain(nueva);
    } catch (error) {
      console.error('Error al agregar tarea:', error);
      return null;
    }
  }

  async update(id, tarea) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const actualizado = await Tarea.findByIdAndUpdate(id, tarea, {
        new: true,
        runValidators: true,
      });
      return actualizado ? toPlain(actualizado) : null;
    } catch (error) {
      console.error('Error al actualizar tarea:', error);
      return null;
    }
  }

  async patch(id, campos) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const actualizado = await Tarea.findByIdAndUpdate(
        id,
        { $set: campos },
        { new: true, runValidators: true }
      );
      return actualizado ? toPlain(actualizado) : null;
    } catch (error) {
      console.error('Error al actualizar parcialmente tarea:', error);
      return null;
    }
  }

  async remove(id) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const eliminado = await Tarea.findByIdAndDelete(id);
      return eliminado ? toPlain(eliminado) : null;
    } catch (error) {
      console.error('Error al eliminar tarea:', error);
      return null;
    }
  }
}

export default new TareaModel();


=====================================================

# Archivo: models\UsuarioModel.js

// models/UsuarioModel.js
import mongoose from 'mongoose';
import bcrypt from 'bcryptjs';

const UsuarioSchema = new mongoose.Schema(
  {
    nombre: { type: String, required: true, trim: true },
    email: { 
      type: String, 
      required: true, 
      unique: true, 
      lowercase: true, 
      trim: true 
    },
    password: { type: String, required: true, minlength: 6 },
    rol: {
      type: String,
      enum: ['administrador', 'planner', 'coordinador'],
      default: 'coordinador',
    },
    area: {
      type: String,
      enum: ['ProducciÃ³n y LogÃ­stica', 'PlanificaciÃ³n y Finanzas', 'AtenciÃ³n al Cliente', 'AdministraciÃ³n'],
      required: true,
    },
    activo: { type: Boolean, default: true }
  },
  { timestamps: true }
);

// Encriptar password antes de guardar
UsuarioSchema.pre('save', async function (next) {
  if (!this.isModified('password')) return next();
  this.password = await bcrypt.hash(this.password, 10);
  next();
});

// MÃ©todo para comparar passwords
UsuarioSchema.methods.compararPassword = async function (passwordIngresado) {
  return await bcrypt.compare(passwordIngresado, this.password);
};

const Usuario = mongoose.models.Usuario || mongoose.model('Usuario', UsuarioSchema);

// FunciÃ³n auxiliar para convertir a objeto plano
function toPlain(doc) {
  if (!doc) return null;
  const obj = doc.toObject({ versionKey: false });
  obj.id = String(obj._id);
  delete obj.password; // NUNCA devolver el password
  return obj;
}

class UsuarioModel {
  async getAll() {
    try {
      const usuarios = await Usuario.find({ activo: true }).sort({ createdAt: -1 });
      return usuarios.map(toPlain);
    } catch (error) {
      console.error('Error al obtener usuarios:', error);
      return [];
    }
  }

  async getById(id) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const usuario = await Usuario.findById(id);
      return toPlain(usuario);
    } catch (error) {
      console.error('Error al obtener usuario:', error);
      return null;
    }
  }

  async getByEmail(email) {
    try {
      const usuario = await Usuario.findOne({ email: email.toLowerCase() });
      return usuario; // Devolvemos el documento completo para poder usar compararPassword
    } catch (error) {
      console.error('Error al buscar usuario por email:', error);
      return null;
    }
  }

  async add(usuario) {
    try {
      const nuevo = await Usuario.create(usuario);
      return toPlain(nuevo);
    } catch (error) {
      console.error('Error al crear usuario:', error);
      return null;
    }
  }

  async update(id, usuario) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      const actualizado = await Usuario.findByIdAndUpdate(id, usuario, {
        new: true,
        runValidators: true,
      });
      return toPlain(actualizado);
    } catch (error) {
      console.error('Error al actualizar usuario:', error);
      return null;
    }
  }

  async remove(id) {
    if (!mongoose.isValidObjectId(id)) return null;
    try {
      // Soft delete: solo marcamos como inactivo
      const eliminado = await Usuario.findByIdAndUpdate(
        id,
        { activo: false },
        { new: true }
      );
      return toPlain(eliminado);
    } catch (error) {
      console.error('Error al eliminar usuario:', error);
      return null;
    }
  }
}

export default new UsuarioModel();

=====================================================

# Archivo: package.json

{
  "name": "eventify-backend",
  "version": "2.0.0",
  "description": "Sistema de gestiÃ³n de eventos con Node.js, Express y MongoDB",
  "main": "app.js",
  "type": "module",
  "scripts": {
  "start": "nodemon app.js",
  "test": "node --experimental-vm-modules ./node_modules/jest/bin/jest.js --detectOpenHandles --forceExit",
  "test:watch": "node --experimental-vm-modules ./node_modules/jest/bin/jest.js --watch",
  "test:coverage": "node --experimental-vm-modules ./node_modules/jest/bin/jest.js --coverage"
}
,
  "jest": {
    "testEnvironment": "node",
    "setupFilesAfterEnv": ["<rootDir>/tests/setup.js"],
    "coveragePathIgnorePatterns": ["/node_modules/"],
    "testMatch": ["**/tests/**/*.test.js"],
    "transform": {}
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/micakn/eventify-backend.git"
  },
  "keywords": ["eventos", "backend", "nodejs", "express", "mongodb"],
  "author": "Micaela Knass y Gerardo",
  "license": "ISC",
  "dependencies": {
    "bcryptjs": "^3.0.3",
    "cookie-parser": "^1.4.7",
    "dotenv": "^16.6.1",
    "express": "^4.18.2",
    "jsonwebtoken": "^9.0.2",
    "method-override": "^3.0.0",
    "mongoose": "^8.19.2",
    "pug": "^3.0.2"
  },
  "devDependencies": {
    "jest": "^29.7.0",
    "mongodb-memory-server": "^9.1.5",
    "nodemon": "^3.1.10",
    "supertest": "^6.3.3"
  }
}

=====================================================

# Archivo: publics\css\styles.css

/* public/css/style.css */
html,
body {
  height: 100%;
  margin: 0;
  display: flex;
  flex-direction: column;
}

.main-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.sidebar {
  min-height: 100vh;
  background-color: #f8f9fa;
  border-right: 1px solid #dee2e6;
}

.nav-link {
  color: #495057;
  border-radius: 0.375rem;
  margin: 0.125rem 0;
}

.nav-link:hover,
.nav-link.active {
  background-color: #e9ecef;
  color: #0d6efd;
}

.main-content {
  background-color: #ffffff;
}

.avatar-placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
}

.hero-section {
  background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
}

/* ESTILO DEFINITIVO PARA ENCABEZADOS DE TABLAS */
.encabezado-tabla th {
  background: #e4ecf3ff !important;
  color: #378addff !important;
  border-bottom: 2px solid #e9ecef !important;
  font-weight: 700 !important;
  font-size: 1rem !important;
  padding: 1rem 0.75rem !important;
  border-top: none !important;
  vertical-align: middle !important;
}

/* Solo bordes superiores redondeados */
.encabezado-tabla th:first-child {
  border-top-left-radius: 0.375rem !important;
}

.encabezado-tabla th:last-child {
  border-top-right-radius: 0.375rem !important;
}

/* Estilos para el logo */
.logo-container {
  display: flex;
  align-items: center;
  justify-content: center;
}

.logo-img {
  width: 180px;
  height: auto;
  max-width: 100%;
  object-fit: contain;
}

=====================================================

# Archivo: publics\js\filtros.js

// public/js/filtros.js

class FiltrosUtil {
    static aplicarFiltrosTabla(searchInputId, filterSelectId, config = {}) {
        const searchInput = document.getElementById(searchInputId);
        const filterSelect = document.getElementById(filterSelectId);
        
        if (!searchInput || !filterSelect) {
            console.warn('Elementos de filtro no encontrados');
            return;
        }

        const tableRows = document.querySelectorAll('tbody tr');
        const searchColumn = config.searchColumn || 0;
        const filterColumn = config.filterColumn !== undefined ? config.filterColumn : 
                            (filterSelectId.includes('estado') ? 4 : 5);

        function aplicarFiltros() {
            const searchTerm = searchInput.value.toLowerCase();
            const filterValue = filterSelect.value;

            tableRows.forEach(row => {
                const searchText = row.cells[searchColumn].textContent.toLowerCase();
                const filterCell = row.cells[filterColumn];
                const filterText = filterCell ? filterCell.textContent.toLowerCase() : '';
                
                const coincideBusqueda = searchText.includes(searchTerm) || 
                                       (config.searchAdditionalColumns ? 
                                        config.searchAdditionalColumns.some(col => {
                                            const additionalCell = row.cells[col];
                                            return additionalCell ? additionalCell.textContent.toLowerCase().includes(searchTerm) : false;
                                        }) : false);
                
                const coincideFiltro = filterValue === 'all' || 
                                      filterText.includes(filterValue.toLowerCase());

                row.style.display = (coincideBusqueda && coincideFiltro) ? '' : 'none';
            });

            this.mostrarMensajeNoResultados(tableRows);
        }

        searchInput.addEventListener('input', aplicarFiltros.bind(this));
        filterSelect.addEventListener('change', aplicarFiltros.bind(this));
        aplicarFiltros.bind(this)();
    }

    static mostrarMensajeNoResultados(tableRows) {
        const visibleRows = Array.from(tableRows).filter(row => row.style.display !== 'none');
        const noResultsMessage = document.getElementById('noResultsMessage');
        
        if (visibleRows.length === 0) {
            if (!noResultsMessage) {
                this.crearMensajeNoResultados();
            }
        } else if (noResultsMessage) {
            noResultsMessage.remove();
        }
    }

    static crearMensajeNoResultados() {
        const tbody = document.querySelector('tbody');
        const tr = document.createElement('tr');
        tr.id = 'noResultsMessage';
        tr.innerHTML = `
            <td colspan="100%" class="text-center py-4">
                <i class="bi bi-search fs-1 text-muted"></i>
                <h5 class="mt-3 text-muted">No se encontraron resultados</h5>
                <p class="text-muted">Intenta con otros tÃ©rminos de bÃºsqueda o filtros</p>
            </td>
        `;
        tbody.appendChild(tr);
    }
}

// ConfiguraciÃ³n de filtros por mÃ³dulo: define inputs y columnas a usar para cada vista
const FiltrosConfig = {
    eventos: {
        searchInputId: 'searchInput',
        filterSelectId: 'filterEstado',
        config: {
            searchColumn: 0,
            searchAdditionalColumns: [3],
            filterColumn: 4 // Estado estÃ¡ en la columna 4
        }
    },
    
    clientes: {
        searchInputId: 'searchInput', 
        filterSelectId: 'filterType',
        config: {
            searchColumn: 1,
            searchAdditionalColumns: [2],
            filterColumn: 4 // Tipo estÃ¡ en la columna 4
        }
    }
};

// InicializaciÃ³n automÃ¡tica
document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('filterEstado')) {
        FiltrosUtil.aplicarFiltrosTabla(
            FiltrosConfig.eventos.searchInputId,
            FiltrosConfig.eventos.filterSelectId,
            FiltrosConfig.eventos.config
        );
    }
    
    if (document.getElementById('filterType')) {
        FiltrosUtil.aplicarFiltrosTabla(
            FiltrosConfig.clientes.searchInputId,
            FiltrosConfig.clientes.filterSelectId,
            FiltrosConfig.clientes.config
        );
    }
});

// Soporte para Empleados y Tareas
document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('filterRole')) {
        FiltrosUtil.aplicarFiltrosTabla('searchInput', 'filterRole', {
            searchColumn: 1, // Nombre
            searchAdditionalColumns: [3,4], // Ãrea, Email
            filterColumn: 2 // Rol
        });
    }

    if (document.getElementById('filterEstadoTareas')) {
        FiltrosUtil.aplicarFiltrosTabla('searchInput', 'filterEstadoTareas', {
            searchColumn: 1, // TÃ­tulo
            searchAdditionalColumns: [2], // Ãrea
            filterColumn: 3 // Estado
        });
    }
});


=====================================================

# Archivo: README.md

# Eventify - Sistema de GestiÃ³n de Eventos

## DescripciÃ³n

Eventify es una aplicaciÃ³n web backend desarrollada con Node.js, Express y MongoDB Atlas para la gestiÃ³n integral de eventos. El sistema permite administrar clientes, empleados, eventos y tareas organizadas por Ã¡reas de trabajo.

## Equipo de Desarrollo

- **Micaela**
- **Gerardo**

## TecnologÃ­as Utilizadas

- **Node.js** v16+
- **Express** v4.18.2
- **MongoDB Atlas** con Mongoose v8.19.2
- **Pug** v3.0.2 (Motor de plantillas)
- **JWT** (AutenticaciÃ³n)
- **bcryptjs** (EncriptaciÃ³n de contraseÃ±as)
- **Bootstrap 5** (Frontend)

## CaracterÃ­sticas Principales

### MÃ³dulos del Sistema

1. **GestiÃ³n de Clientes**
   - CRUD completo de clientes
   - Registro de informaciÃ³n de contacto y empresas
   - Tipos de cliente (individual/empresa)

2. **GestiÃ³n de Empleados**
   - AdministraciÃ³n de personal
   - Roles: Administrador, Planner, Coordinador
   - Ãreas: ProducciÃ³n y LogÃ­stica, PlanificaciÃ³n y Finanzas, AtenciÃ³n al Cliente, AdministraciÃ³n

3. **GestiÃ³n de Eventos**
   - CreaciÃ³n y seguimiento de eventos
   - AsignaciÃ³n de clientes y empleados responsables
   - Control de fechas, lugar y presupuesto
   - Estados: Activo, Pendiente, Finalizado, Cancelado

4. **GestiÃ³n de Tareas**
   - Tareas organizadas por Ã¡rea y tipo
   - AsignaciÃ³n a empleados y eventos
   - Control de estado y prioridad
   - Seguimiento de horas estimadas vs. reales

### Sistema de AutenticaciÃ³n

- Registro e inicio de sesiÃ³n de usuarios
- AutenticaciÃ³n con JWT almacenado en cookies
- Middleware de verificaciÃ³n de autenticaciÃ³n
- ProtecciÃ³n de rutas

## Estructura del Proyecto

```
eventify-backend/
â”œâ”€â”€ controllers/          # LÃ³gica de negocio
â”œâ”€â”€ models/              # Esquemas de Mongoose
â”œâ”€â”€ routes/              # DefiniciÃ³n de rutas API y Web
â”œâ”€â”€ views/               # Plantillas Pug
â”œâ”€â”€ middleware/          # Middlewares personalizados
â”œâ”€â”€ db/                  # ConfiguraciÃ³n de base de datos
â”œâ”€â”€ public/              # Archivos estÃ¡ticos
â”œâ”€â”€ tests/               # Pruebas unitarias
â”œâ”€â”€ app.js               # ConfiguraciÃ³n principal
â”œâ”€â”€ seed.js              # Carga de datos iniciales
â””â”€â”€ .env                 # Variables de entorno
```

## InstalaciÃ³n y ConfiguraciÃ³n

### Requisitos Previos

- Node.js v16 o superior
- Cuenta en MongoDB Atlas
- NPM o Yarn

### Pasos de InstalaciÃ³n

1. Clonar el repositorio:
```bash
git clone https://github.com/micakn/eventify-backend.git
cd eventify-backend
```

2. Instalar dependencias:
```bash
npm install
```

3. Configurar variables de entorno:

Crear archivo `.env` en la raÃ­z del proyecto:
```env
PORT=3000
MONGODB_URI=mongodb+srv://usuario:password@cluster.mongodb.net/eventify
JWT_SECRET=tu_clave_secreta_aqui
JWT_EXPIRES_IN=7d
```

4. Cargar datos iniciales (opcional):
```bash
node seed.js
```

5. Iniciar el servidor:
```bash
npm start
```

El servidor estarÃ¡ disponible en `http://localhost:3000`

## Uso de la API

### AutenticaciÃ³n

#### Registro de Usuario
```
POST /auth/registro
Content-Type: application/json

{
  "nombre": "Juan PÃ©rez",
  "email": "juan@example.com",
  "password": "password123",
  "passwordConfirm": "password123",
  "rol": "coordinador",
  "area": "ProducciÃ³n y LogÃ­stica"
}
```

#### Inicio de SesiÃ³n
```
POST /auth/login
Content-Type: application/json

{
  "email": "juan@example.com",
  "password": "password123"
}
```

### Endpoints Principales

Todas las rutas API requieren autenticaciÃ³n mediante JWT en cookies.

#### Clientes
- `GET /api/clientes` - Listar todos los clientes
- `GET /api/clientes/:id` - Obtener un cliente
- `POST /api/clientes` - Crear cliente
- `PUT /api/clientes/:id` - Actualizar cliente
- `DELETE /api/clientes/:id` - Eliminar cliente

#### Empleados
- `GET /api/empleados` - Listar empleados
- `POST /api/empleados` - Crear empleado
- `PUT /api/empleados/:id` - Actualizar empleado
- `DELETE /api/empleados/:id` - Eliminar empleado

#### Eventos
- `GET /api/eventos` - Listar eventos
- `POST /api/eventos` - Crear evento
- `PUT /api/eventos/:id` - Actualizar evento
- `DELETE /api/eventos/:id` - Eliminar evento

#### Tareas
- `GET /api/tareas` - Listar tareas (con filtros opcionales)
- `POST /api/tareas` - Crear tarea
- `PUT /api/tareas/:id` - Actualizar tarea
- `DELETE /api/tareas/:id` - Eliminar tarea

### Filtros en Tareas

```
GET /api/tareas?estado=pendiente
GET /api/tareas?prioridad=alta
GET /api/tareas?empleadoAsignado=ID_EMPLEADO
GET /api/tareas?fechaInicio=2025-01-01&fechaFin=2025-12-31
```

## Testing

El proyecto incluye pruebas unitarias con Jest y Supertest.

### Ejecutar Pruebas

```bash
npm test
```

### Ejecutar Pruebas en Modo Watch
```bash
npm run test:watch
```

Las pruebas cubren:
- Operaciones CRUD de clientes
- Operaciones CRUD de empleados
- Validaciones de datos
- Manejo de errores

## Decisiones TÃ©cnicas

### Base de Datos
Se eligiÃ³ MongoDB Atlas por su flexibilidad para manejar datos no relacionales y su fÃ¡cil integraciÃ³n con Node.js mediante Mongoose. La estructura de documentos permite almacenar relaciones mediante referencias (ObjectId) y utilizar `populate()` para obtener datos relacionados.

### AutenticaciÃ³n
Se implementÃ³ JWT con almacenamiento en cookies HttpOnly por seguridad. Esto previene ataques XSS y facilita el manejo de sesiones en aplicaciones web.

### PatrÃ³n MVC
La arquitectura MVC separa la lÃ³gica de negocio (controllers), los datos (models) y la presentaciÃ³n (views), facilitando el mantenimiento y la escalabilidad del cÃ³digo.

### Validaciones
Las validaciones se realizan en dos niveles:
1. Esquema de Mongoose (validaciones de base de datos)
2. Controladores (validaciones de lÃ³gica de negocio)

## Scripts Disponibles

```bash
npm start          # Iniciar servidor con nodemon
npm test           # Ejecutar pruebas
npm run test:watch # Ejecutar pruebas en modo watch
node seed.js       # Cargar datos de prueba
```

## Seguridad

- ContraseÃ±as encriptadas con bcrypt
- Tokens JWT con expiraciÃ³n configurable
- Cookies HttpOnly para prevenir XSS
- ValidaciÃ³n de ObjectId antes de consultas
- Variables sensibles en archivo .env
- Middleware de autenticaciÃ³n en rutas protegidas

## Estado del Proyecto

VersiÃ³n: 2.0

### Mejoras Implementadas (vs. VersiÃ³n 1.0)

- Sistema completo de autenticaciÃ³n y autorizaciÃ³n
- ProtecciÃ³n de rutas mediante middleware
- Interfaz web con Pug y Bootstrap
- Validaciones mejoradas en modelos y controladores
- GestiÃ³n de relaciones entre entidades
- Filtrado avanzado de tareas
- Manejo de errores robusto
- Testing unitario implementado

### Limitaciones Conocidas

- No implementa paginaciÃ³n en listados grandes
- Sin rate limiting en API
- Logs de actividad pendientes
- Sistema de roles bÃ¡sico (sin permisos granulares)


## Licencia

ISC

## Repositorio

[https://github.com/micakn/eventify-backend](https://github.com/micakn/eventify-backend)

## Contacto

Para consultas o soporte, contactar a los desarrolladores del proyecto.

=====================================================

# Archivo: routes\authRoutes.js

// routes/authRoutes.js
import express from 'express';
import * as authController from '../controllers/authController.js';
import { verificarAuth } from '../middleware/auth.js';

const router = express.Router();

// Rutas pÃºblicas
router.get('/registro', authController.mostrarRegistro);
router.post('/registro', authController.registrar);
router.get('/login', authController.mostrarLogin);
router.post('/login', authController.login);
router.get('/logout', authController.logout);

// Rutas protegidas
router.get('/perfil', verificarAuth, authController.perfil);

export default router;

=====================================================

# Archivo: routes\clienteRoutes.js

//
import express from 'express';
import clienteController from '../controllers/clienteController.js';

const router = express.Router();

router.get('/', clienteController.listClientes);// LISTAR todos los clientes
router.get('/:id', clienteController.getCliente);// OBTENER un cliente por ID
router.post('/', clienteController.addCliente);// CREAR un nuevo cliente
router.put('/:id', clienteController.updateCliente);// REEMPLAZAR un cliente completo
router.patch('/:id', clienteController.patchCliente);// ACTUALIZAR parcialmente un cliente
router.delete('/:id', clienteController.deleteCliente);// ELIMINAR un cliente

export default router;


=====================================================

# Archivo: routes\clienteWebRoutes.js

// routes/clienteWebRoutes.js
import express from 'express';
import ClienteWebController from '../controllers/ClienteWebController.js';

const router = express.Router();

router.get('/', ClienteWebController.listClientesWeb);       // /clientes
router.get('/nuevo', ClienteWebController.showNewForm);      // /clientes/nuevo
router.get('/editar/:id', ClienteWebController.showEditForm);// /clientes/editar/:id
router.get('/:id', ClienteWebController.showCliente);        // /clientes/:id

router.post('/', ClienteWebController.createClienteWeb);     // crear
router.put('/:id', ClienteWebController.updateClienteWeb);   // editar
router.delete('/:id', ClienteWebController.deleteClienteWeb);// eliminar

export default router;


=====================================================

# Archivo: routes\empleadoRoutes.js

// routes/empleadoRoutes.js
import express from 'express';
import empleadoController from '../controllers/empleadoController.js';

const router = express.Router();

router.get('/', empleadoController.listEmpleados);// LISTAR todos los empleados
router.get('/:id', empleadoController.getEmpleado);// OBTENER empleado por ID
router.post('/', empleadoController.addEmpleado);// CREAR un nuevo empleado
router.put('/:id', empleadoController.updateEmpleado);// REEMPLAZAR un empleado completo
router.patch('/:id', empleadoController.patchEmpleado);// ACTUALIZAR parcialmente un empleado
router.delete('/:id', empleadoController.deleteEmpleado);// ELIMINAR un empleado

export default router;





=====================================================

# Archivo: routes\empleadoWebRoutes.js

// routes/empleadoWebRoutes.js
import express from 'express';
import EmpleadoWebController from '../controllers/EmpleadoWebController.js';

const router = express.Router();

// Rutas para empleados
router.get('/', EmpleadoWebController.listarEmpleados);
router.get('/crear', EmpleadoWebController.mostrarFormularioCrear);
router.post('/crear', EmpleadoWebController.crearEmpleado);
router.get('/editar/:id', EmpleadoWebController.mostrarFormularioEditar);
router.post('/editar/:id', EmpleadoWebController.actualizarEmpleado);
router.post('/eliminar/:id', EmpleadoWebController.eliminarEmpleado);
// Ruta para ver detalle de empleado
router.get('/:id', EmpleadoWebController.mostrarEmpleado);

export default router;

=====================================================

# Archivo: routes\eventoRoutes.js

// routes/eventoRoutes.js
import express from 'express';
import eventoController from '../controllers/eventoController.js';

const router = express.Router();

router.get('/', eventoController.listEventos);// LISTAR todos los eventos
router.get('/:id', eventoController.getEvento);// OBTENER un evento por ID
router.post('/', eventoController.addEvento);// CREAR un nuevo evento
router.put('/:id', eventoController.updateEvento);// REEMPLAZAR un evento completo
router.patch('/:id', eventoController.patchEvento);// ACTUALIZAR parcialmente un evento
router.delete('/:id', eventoController.deleteEvento);// ELIMINAR un evento

export default router;



=====================================================

# Archivo: routes\eventoWebRoutes.js

// routes/eventoWebRoutes.js
import express from 'express';
import EventoWebController from '../controllers/EventoWebController.js';

const router = express.Router();

// Las rutas ya tienen el prefijo /eventos desde app.js
router.get('/', EventoWebController.listarEventos);                    // GET /eventos
router.get('/crear', EventoWebController.mostrarFormularioCrear);      // GET /eventos/crear
router.post('/crear', EventoWebController.crearEvento);                // POST /eventos/crear
router.get('/editar/:id', EventoWebController.mostrarFormularioEditar);// GET /eventos/editar/:id
router.post('/editar/:id', EventoWebController.actualizarEvento);      // POST /eventos/editar/:id
router.post('/eliminar/:id', EventoWebController.eliminarEvento);      // POST /eventos/eliminar/:id
// Ruta para ver detalle de un evento
router.get('/ver/:id', EventoWebController.mostrarEvento);            // GET /eventos/ver/:id

export default router;

=====================================================

# Archivo: routes\tareaRoutes.js

// routes/tareaRoutes.js
import express from 'express';
import tareaController from '../controllers/tareaController.js';

const router = express.Router();

router.get('/', tareaController.listTareas);// LISTAR todas las tareas y filtrarlas
router.get('/:id', tareaController.getTarea);// OBTENER tarea por ID
router.post('/', tareaController.addTarea);// CREAR nueva tarea
router.put('/:id', tareaController.updateTarea);// REEMPLAZAR tarea completa
router.patch('/:id', tareaController.patchTarea);// ACTUALIZAR parcial de tarea
router.delete('/:id', tareaController.deleteTarea);// ELIMINAR tarea

export default router;




=====================================================

# Archivo: routes\tareaWebRoutes.js

// routes/tareaWebRoutes.js
import express from 'express';
import TareaWebController from '../controllers/TareaWebController.js';

const router = express.Router();

// Rutas para tareas
router.get('/', TareaWebController.listarTareas);
router.get('/crear', TareaWebController.mostrarFormularioCrear);
router.post('/crear', TareaWebController.crearTarea);
router.get('/editar/:id', TareaWebController.mostrarFormularioEditar);
router.post('/editar/:id', TareaWebController.actualizarTarea);
router.post('/eliminar/:id', TareaWebController.eliminarTarea);
// Ruta para ver detalle de tarea
router.get('/:id', TareaWebController.mostrarTarea);

export default router;

=====================================================

# Archivo: seed.js

// seed.js
// -------------------- SEED - CARGA INICIAL DE DATOS --------------------
import dotenv from 'dotenv';
import mongoose from 'mongoose';
import { connectMongo, disconnectMongo } from './db/mongoose.js';

dotenv.config();

// -------------------- DEFINICIÃ“N DE MODELOS TEMPORALES --------------------
const Cliente =
  mongoose.models.Cliente ||
  mongoose.model(
    'Cliente',
    new mongoose.Schema({
      nombre: String,
      email: String,
      telefono: String,
      empresa: String,
      notas: String,
    })
  );

const Empleado =
  mongoose.models.Empleado ||
  mongoose.model(
    'Empleado',
    new mongoose.Schema({
      nombre: String,
      rol: String,
      area: String,
      email: String,
      telefono: String,
    })
  );

const Evento =
  mongoose.models.Evento ||
  mongoose.model(
    'Evento',
    new mongoose.Schema({
      nombre: String,
      descripcion: String,
      fechaInicio: Date,
      fechaFin: Date,
      lugar: String,
      clienteId: { type: mongoose.Schema.Types.ObjectId, ref: 'Cliente' },
      empleadoId: { type: mongoose.Schema.Types.ObjectId, ref: 'Empleado' },
    })
  );

const Tarea =
  mongoose.models.Tarea ||
  mongoose.model(
    'Tarea',
    new mongoose.Schema({
      titulo: String,
      descripcion: String,
      estado: String,
      fechaInicio: Date,
      fechaFin: Date,
      prioridad: String,
      area: String,
      tipo: String,
      empleadoAsignado: { type: mongoose.Schema.Types.ObjectId, ref: 'Empleado' },
      eventoAsignado: { type: mongoose.Schema.Types.ObjectId, ref: 'Evento' },
      horasEstimadas: Number,
      horasReales: Number,
    })
  );

// -------------------- DATOS --------------------
const clientesSeed = [
  {
    nombre: 'Vitalia S.A.',
    email: 'contacto@vitalia.com',
    telefono: '+5491122334455',
    empresa: 'Vitalia',
    notas: 'Cliente corporativo del sector salud',
  },
  {
    nombre: 'Club Deportivo El Molino',
    email: 'clubelmolino@gmail.com',
    telefono: '+5491166677788',
    empresa: 'Club El Molino',
    notas: 'Cliente institucional con eventos anuales',
  },
  {
    nombre: 'Cultura Viva ONG',
    email: 'info@culturaviva.org',
    telefono: '+5491155522233',
    empresa: 'Cultura Viva',
    notas: 'OrganizaciÃ³n sin fines de lucro',
  },
  {
    nombre: 'Innovar S.R.L.',
    email: 'proyectos@innovar.com',
    telefono: '+5491188899911',
    empresa: 'Innovar',
    notas: 'Empresa tecnolÃ³gica que organiza workshops mensuales',
  },
];

const empleadosSeed = [
  {
    nombre: 'Juan Gonzales',
    rol: 'coordinador',
    area: 'ProducciÃ³n y LogÃ­stica',
    email: 'juan@example.com',
    telefono: '+541122223336',
  },
  {
    nombre: 'SofÃ­a RamÃ­rez',
    rol: 'planner',
    area: 'PlanificaciÃ³n y Finanzas',
    email: 'sofia.ramirez@example.com',
    telefono: '+541133366677',
  },
  {
    nombre: 'Alex Lopez',
    rol: 'administrador',
    area: 'AdministraciÃ³n',
    email: 'alex@example.com',
    telefono: '+541122223335',
  },
  {
    nombre: 'MarÃ­a FernÃ¡ndez',
    rol: 'planner',
    area: 'PlanificaciÃ³n y Finanzas',
    email: 'maria.fernandez@example.com',
    telefono: '+541199955577',
  },
  {
    nombre: 'Gonzalo PÃ©rez',
    rol: 'coordinador',
    area: 'ProducciÃ³n y LogÃ­stica',
    email: 'gonzalo.perez@example.com',
    telefono: '+541144488899',
  },
];

const eventosSeed = [
  {
    nombre: 'Festival de InnovaciÃ³n',
    descripcion: 'Evento anual con charlas, talleres y networking',
    lugar: 'Centro de Convenciones',
    fechaInicio: new Date('2025-11-10'),
    fechaFin: new Date('2025-11-12'),
  },
  {
    nombre: 'PresentaciÃ³n App Eventify',
    descripcion: 'Lanzamiento del sistema de gestiÃ³n Eventify',
    lugar: 'Auditorio Principal',
    fechaInicio: new Date('2025-12-01'),
    fechaFin: new Date('2025-12-02'),
  },
  {
    nombre: 'Expo Emprendedores 2025',
    descripcion: 'Feria de emprendimientos y rondas de inversiÃ³n',
    lugar: 'Parque TecnolÃ³gico Buenos Aires',
    fechaInicio: new Date('2025-09-15'),
    fechaFin: new Date('2025-09-18'),
  },
  {
    nombre: 'Foro de Software Libre',
    descripcion: 'Charlas y paneles sobre cÃ³digo abierto y colaboraciÃ³n',
    lugar: 'Centro Cultural San MartÃ­n',
    fechaInicio: new Date('2025-08-22'),
    fechaFin: new Date('2025-08-23'),
  },
];

// -------------------- FUNCIÃ“N PRINCIPAL --------------------
async function seedDB() {
  await connectMongo(process.env.MONGODB_URI);
  console.log('Conectado a MongoDB Atlas');
  console.log('Limpiando base de datos...');

  await Promise.all([
    Cliente.deleteMany(),
    Empleado.deleteMany(),
    Evento.deleteMany(),
    Tarea.deleteMany(),
  ]);

  console.log('Insertando datos base...');
  const clientes = await Cliente.insertMany(clientesSeed);
  const empleados = await Empleado.insertMany(empleadosSeed);
  const eventos = await Evento.insertMany(eventosSeed);

  // Asignar clientes y empleados responsables a eventos (para que en la vista se vean ambas relaciones)
  try {
    await Promise.all([
      Evento.findByIdAndUpdate(eventos[0]._id, { clienteId: clientes[0]._id, empleadoId: empleados[0]._id }),
      Evento.findByIdAndUpdate(eventos[1]._id, { clienteId: clientes[3]._id, empleadoId: empleados[1]._id }),
      Evento.findByIdAndUpdate(eventos[2]._id, { clienteId: clientes[1]._id, empleadoId: empleados[2]._id }),
      Evento.findByIdAndUpdate(eventos[3]._id, { clienteId: clientes[2]._id, empleadoId: empleados[3]._id }),
    ]);
    console.log('Clientes y empleados asignados a eventos en seed');
  } catch (err) {
    console.error('Error asignando clientes/empleados a eventos en seed:', err);
  }

  const tareasSeed = [
    // ---- ProducciÃ³n y LogÃ­stica ----
    {
      titulo: 'CoordinaciÃ³n con proveedores',
      descripcion: 'Gestionar catering, sonido y mobiliario del evento',
      estado: 'pendiente',
      prioridad: 'alta',
      area: 'ProducciÃ³n y LogÃ­stica',
      tipo: 'CoordinaciÃ³n con proveedores',
      horasEstimadas: 6,
      empleadoAsignado: empleados[0]._id,
      eventoAsignado: eventos[0]._id,
    },
    {
      titulo: 'Montaje de escenario o mobiliario',
      descripcion: 'Supervisar montaje de escenario principal y seÃ±alÃ©tica',
      estado: 'en proceso',
      prioridad: 'media',
      area: 'ProducciÃ³n y LogÃ­stica',
      tipo: 'Montaje de escenario o mobiliario',
      horasEstimadas: 8,
      empleadoAsignado: empleados[4]._id,
      eventoAsignado: eventos[2]._id,
    },
    {
      titulo: 'VerificaciÃ³n tÃ©cnica previa al evento',
      descripcion: 'Revisar iluminaciÃ³n, sonido y conectividad general',
      estado: 'finalizada',
      prioridad: 'alta',
      area: 'ProducciÃ³n y LogÃ­stica',
      tipo: 'VerificaciÃ³n tÃ©cnica previa',
      horasEstimadas: 4,
      empleadoAsignado: empleados[4]._id,
      eventoAsignado: eventos[1]._id,
    },
    {
      titulo: 'SupervisiÃ³n de desmontaje post-evento',
      descripcion: 'Verificar retiro de equipos y mobiliario alquilado',
      estado: 'pendiente',
      prioridad: 'media',
      area: 'ProducciÃ³n y LogÃ­stica',
      tipo: 'Montaje de escenario o mobiliario',
      horasEstimadas: 5,
      empleadoAsignado: empleados[0]._id,
      eventoAsignado: eventos[3]._id,
    },

    // ---- PlanificaciÃ³n y Finanzas ----
    {
      titulo: 'Carga y control del presupuesto del evento',
      descripcion: 'Registrar gastos y controlar desviaciones presupuestarias',
      estado: 'finalizada',
      prioridad: 'alta',
      area: 'PlanificaciÃ³n y Finanzas',
      tipo: 'Carga y control del presupuesto del evento',
      horasEstimadas: 5,
      empleadoAsignado: empleados[1]._id,
      eventoAsignado: eventos[1]._id,
    },
    {
      titulo: 'Firma de contratos con clientes/proveedores',
      descripcion: 'Revisar y firmar contratos legales y administrativos',
      estado: 'pendiente',
      prioridad: 'media',
      area: 'PlanificaciÃ³n y Finanzas',
      tipo: 'Firma de contratos con clientes/proveedores',
      horasEstimadas: 3,
      empleadoAsignado: empleados[3]._id,
      eventoAsignado: eventos[2]._id,
    },
    {
      titulo: 'Seguimiento del cronograma y fechas clave',
      descripcion: 'Controlar hitos del evento y alertar desvÃ­os',
      estado: 'en proceso',
      prioridad: 'media',
      area: 'PlanificaciÃ³n y Finanzas',
      tipo: 'Seguimiento del cronograma y fechas clave',
      horasEstimadas: 4,
      empleadoAsignado: empleados[3]._id,
      eventoAsignado: eventos[0]._id,
    },
    {
      titulo: 'ElaboraciÃ³n de informe financiero post-evento',
      descripcion: 'Analizar costos reales vs estimados y elaborar informe final',
      estado: 'pendiente',
      prioridad: 'alta',
      area: 'PlanificaciÃ³n y Finanzas',
      tipo: 'Carga y control del presupuesto del evento',
      horasEstimadas: 4,
      empleadoAsignado: empleados[1]._id,
      eventoAsignado: eventos[3]._id,
    },

    // ---- AdministraciÃ³n ----
    {
      titulo: 'Mantenimiento de base de datos de clientes',
      descripcion: 'Actualizar informaciÃ³n y contacto de clientes activos',
      estado: 'en proceso',
      prioridad: 'media',
      area: 'AdministraciÃ³n',
      tipo: 'GestiÃ³n de usuarios del sistema',
      horasEstimadas: 2,
      empleadoAsignado: empleados[2]._id,
      eventoAsignado: eventos[1]._id,
    },
    {
      titulo: 'Control de permisos y accesos de usuarios',
      descripcion: 'Revisar roles y accesos de los empleados del sistema',
      estado: 'pendiente',
      prioridad: 'baja',
      area: 'AdministraciÃ³n',
      tipo: 'Control de permisos y accesos',
      horasEstimadas: 3,
      empleadoAsignado: empleados[2]._id,
      eventoAsignado: eventos[2]._id,
    },
  ];

  await Tarea.insertMany(tareasSeed);
  console.log('Tareas cargadas correctamente');

  await disconnectMongo();
  console.log('ConexiÃ³n cerrada con MongoDB');
}

// -------------------- EJECUCIÃ“N --------------------
seedDB()
  .then(() => process.exit(0))
  .catch((err) => {
    console.error('Error al cargar datos:', err);
    process.exit(1);
  });


=====================================================

# Archivo: tests\auth.test.js

// tests/auth.test.js
import request from 'supertest';
import express from 'express';
import mongoose from 'mongoose';
import cookieParser from 'cookie-parser';
import path from 'path';
import { fileURLToPath } from 'url';
import authRoutes from '../routes/authRoutes.js';
import { connectMongo, disconnectMongo } from '../db/mongoose.js';

// Configurar __dirname para ES modules
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const app = express();
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(cookieParser());

  // Configurar Pug como motor de vistas para que los tests puedan renderizar formularios
app.set('view engine', 'pug');
app.set('views', path.join(__dirname, '../views'));

app.use('/auth', authRoutes);

describe('Sistema de AutenticaciÃ³n', () => {
  beforeAll(async () => {
    await connectMongo(process.env.MONGODB_URI);
  });

  afterAll(async () => {
    await disconnectMongo();
  });

  beforeEach(async () => {
    // Limpiar usuarios de prueba
    if (mongoose.connection.collections.usuarios) {
      await mongoose.connection.collections.usuarios.deleteMany({
        email: /test.*@example\.com/
      });
    }
  });

  describe('POST /auth/registro', () => {
    it('debe registrar un nuevo usuario correctamente', async () => {
      const nuevoUsuario = {
        nombre: 'Usuario Test',
        email: 'test-nuevo@example.com',
        password: 'password123',
        passwordConfirm: 'password123',
        rol: 'coordinador',
        area: 'ProducciÃ³n y LogÃ­stica'
      };

      const response = await request(app)
        .post('/auth/registro')
        .send(nuevoUsuario);

      expect(response.status).toBe(302); // RedirecciÃ³n
      expect(response.headers['set-cookie']).toBeDefined(); // Cookie JWT
    });

    it('debe fallar si las contraseÃ±as no coinciden', async () => {
      const usuarioInvalido = {
        nombre: 'Usuario Test',
        email: 'test-invalido@example.com',
        password: 'password123',
        passwordConfirm: 'password456',
        rol: 'coordinador',
        area: 'ProducciÃ³n y LogÃ­stica'
      };

      const response = await request(app)
        .post('/auth/registro')
        .send(usuarioInvalido);

      expect(response.status).toBe(200); // Renderiza form con error
      expect(response.text).toContain('contraseÃ±as no coinciden');
    });

    it('debe fallar si el email ya existe', async () => {
      const usuario = {
        nombre: 'Usuario Duplicado',
        email: 'test-duplicado@example.com',
        password: 'password123',
        passwordConfirm: 'password123',
        rol: 'planner',
        area: 'PlanificaciÃ³n y Finanzas'
      };

      // Crear primer usuario
      await request(app).post('/auth/registro').send(usuario);

      // Intentar crear segundo con mismo email
      const response = await request(app)
        .post('/auth/registro')
        .send(usuario);

      expect(response.status).toBe(200);
      expect(response.text).toContain('email ya estÃ¡ registrado');
    });

    it('debe fallar si la contraseÃ±a es muy corta', async () => {
      const usuario = {
        nombre: 'Usuario Test',
        email: 'test-corto@example.com',
        password: '12345',
        passwordConfirm: '12345',
        rol: 'coordinador',
        area: 'AdministraciÃ³n'
      };

      const response = await request(app)
        .post('/auth/registro')
        .send(usuario);

      expect(response.status).toBe(200);
      expect(response.text).toContain('al menos 6 caracteres');
    });
  });

  describe('POST /auth/login', () => {
    beforeEach(async () => {
      // Crear usuario de prueba para login
      await request(app).post('/auth/registro').send({
        nombre: 'Usuario Login',
        email: 'test-login@example.com',
        password: 'password123',
        passwordConfirm: 'password123',
        rol: 'administrador',
        area: 'AdministraciÃ³n'
      });
    });

    it('debe iniciar sesiÃ³n con credenciales correctas', async () => {
      const response = await request(app)
        .post('/auth/login')
        .send({
          email: 'test-login@example.com',
          password: 'password123'
        });

      expect(response.status).toBe(302); // RedirecciÃ³n
      expect(response.headers['set-cookie']).toBeDefined();
    });

    it('debe fallar con contraseÃ±a incorrecta', async () => {
      const response = await request(app)
        .post('/auth/login')
        .send({
          email: 'test-login@example.com',
          password: 'incorrecta'
        });

      expect(response.status).toBe(200);
      expect(response.text).toContain('Email o contraseÃ±a incorrectos');
    });

    it('debe fallar con email inexistente', async () => {
      const response = await request(app)
        .post('/auth/login')
        .send({
          email: 'noexiste@example.com',
          password: 'password123'
        });

      expect(response.status).toBe(200);
      expect(response.text).toContain('Email o contraseÃ±a incorrectos');
    });
  });

  describe('GET /auth/logout', () => {
    it('debe cerrar sesiÃ³n y limpiar cookie', async () => {
      const response = await request(app).get('/auth/logout');

      expect(response.status).toBe(302); // RedirecciÃ³n
      expect(response.headers['set-cookie'][0]).toContain('token=;');
    });
  });
});

=====================================================

# Archivo: tests\clientes.test.js

// tests/clientes.test.js
import request from 'supertest';
import express from 'express';
import mongoose from 'mongoose';
import clienteRoutes from '../routes/clienteRoutes.js';
import ClienteModel from '../models/ClienteModel.js'; // Importa el modelo Cliente para crear datos de prueba en los tests
import { connectMongo, disconnectMongo } from '../db/mongoose.js';

const app = express();
app.use(express.json());

// Mock de middleware de autenticaciÃ³n para tests
app.use((req, res, next) => {
  req.usuario = { id: 'test-user', nombre: 'Test User' };
  next();
});

app.use('/api/clientes', clienteRoutes);

describe('API de Clientes', () => {
  beforeAll(async () => {
    await connectMongo(process.env.MONGODB_URI);
  });

  afterAll(async () => {
    await disconnectMongo();
  });

  beforeEach(async () => {
    // Limpiar colecciÃ³n de clientes antes de cada prueba
    if (mongoose.connection.collections.clientes) {
      await mongoose.connection.collections.clientes.deleteMany({});
    }
  });

  describe('GET /api/clientes', () => {
    it('debe retornar un array vacÃ­o cuando no hay clientes', async () => {
      const response = await request(app).get('/api/clientes');
      
      expect(response.status).toBe(200);
      expect(Array.isArray(response.body)).toBe(true);
      expect(response.body.length).toBe(0);
    });

    it('debe retornar todos los clientes', async () => {
      // Crear clientes de prueba
      await ClienteModel.add({
        nombre: 'Cliente Test 1',
        email: 'test1@example.com',
        telefono: '123456789',
        empresa: 'Test SA'
      });

      const response = await request(app).get('/api/clientes');
      
      expect(response.status).toBe(200);
      expect(response.body.length).toBe(1);
      expect(response.body[0].nombre).toBe('Cliente Test 1');
    });
  });

  describe('POST /api/clientes', () => {
    it('debe crear un nuevo cliente con datos vÃ¡lidos', async () => {
      const nuevoCliente = {
        nombre: 'Nuevo Cliente',
        email: 'nuevo@example.com',
        telefono: '987654321',
        empresa: 'Nueva Empresa'
      };

      const response = await request(app)
        .post('/api/clientes')
        .send(nuevoCliente);

      expect(response.status).toBe(201);
      expect(response.body.mensaje).toBe('Cliente creado');
      expect(response.body.cliente.nombre).toBe(nuevoCliente.nombre);
    });

    it('debe fallar al crear cliente sin nombre', async () => {
      const clienteInvalido = {
        email: 'invalido@example.com'
      };

      const response = await request(app)
        .post('/api/clientes')
        .send(clienteInvalido);

      expect(response.status).toBe(400);
      expect(response.body.mensaje).toContain('obligatorios');
    });
  });

  describe('GET /api/clientes/:id', () => {
    it('debe retornar un cliente por ID', async () => {
      const cliente = await ClienteModel.add({
        nombre: 'Cliente Test',
        email: 'test@example.com',
        telefono: '111222333'
      });

      const response = await request(app).get(`/api/clientes/${cliente.id}`);

      expect(response.status).toBe(200);
      expect(response.body.nombre).toBe('Cliente Test');
    });

    it('debe retornar 404 si el cliente no existe', async () => {
      const response = await request(app).get('/api/clientes/507f1f77bcf86cd799439011');

      expect(response.status).toBe(404);
    });
  });

  describe('DELETE /api/clientes/:id', () => {
    it('debe eliminar un cliente existente', async () => {
      const cliente = await ClienteModel.add({
        nombre: 'Cliente a Eliminar',
        email: 'eliminar@example.com'
      });

      const response = await request(app).delete(`/api/clientes/${cliente.id}`);

      expect(response.status).toBe(200);
      expect(response.body.mensaje).toBe('Cliente eliminado');

      // Verificar que realmente se eliminÃ³
      const verificar = await ClienteModel.getById(cliente.id);
      expect(verificar).toBeNull();
    });
  });
});

=====================================================

# Archivo: tests\empleados.test.js

// tests/empleados.test.js
import request from 'supertest';
import express from 'express';
import mongoose from 'mongoose';
import empleadoRoutes from '../routes/empleadoRoutes.js';
import { connectMongo, disconnectMongo } from '../db/mongoose.js';

const app = express();
app.use(express.json());

// Mock de middleware de autenticaciÃ³n para tests
app.use((req, res, next) => {
  req.usuario = { id: 'test-user', nombre: 'Test User' };
  next();
});

app.use('/api/empleados', empleadoRoutes);

describe('API de Empleados', () => {
  beforeAll(async () => {
    await connectMongo(process.env.MONGODB_URI);
  });

  afterAll(async () => {
    await disconnectMongo();
  });

  beforeEach(async () => {
    // Limpiar colecciÃ³n de empleados antes de cada prueba
    if (mongoose.connection.collections.empleados) {
      await mongoose.connection.collections.empleados.deleteMany({});
    }
  });

  describe('POST /api/empleados', () => {
    it('debe crear un empleado con datos vÃ¡lidos', async () => {
      const nuevoEmpleado = {
        nombre: 'Juan PÃ©rez',
        rol: 'coordinador',
        area: 'ProducciÃ³n y LogÃ­stica',
        email: 'juan@eventify.com'
      };

      const response = await request(app)
        .post('/api/empleados')
        .send(nuevoEmpleado);

      expect(response.status).toBe(201);
      expect(response.body.empleado.nombre).toBe('Juan PÃ©rez');
      expect(response.body.empleado.rol).toBe('coordinador');
    });

    it('debe rechazar empleado con rol invÃ¡lido', async () => {
      const empleadoInvalido = {
        nombre: 'Test',
        rol: 'rol_invalido',
        area: 'ProducciÃ³n y LogÃ­stica'
      };

      const response = await request(app)
        .post('/api/empleados')
        .send(empleadoInvalido);

      expect(response.status).toBe(400);
      expect(response.body.mensaje).toContain('invÃ¡lido');
    });
  });

  describe('GET /api/empleados', () => {
    it('debe retornar lista de empleados', async () => {
      const response = await request(app).get('/api/empleados');

      expect(response.status).toBe(200);
      expect(Array.isArray(response.body)).toBe(true);
    });
  });
});

=====================================================

# Archivo: tests\eventos.test.js

// tests/eventos.test.js
import request from 'supertest';
import express from 'express';
import mongoose from 'mongoose';
import eventoRoutes from '../routes/eventoRoutes.js';
import ClienteModel from '../models/ClienteModel.js';
import EmpleadoModel from '../models/EmpleadoModel.js';
import { connectMongo, disconnectMongo } from '../db/mongoose.js';

const app = express();
app.use(express.json());

// Mock de autenticaciÃ³n
app.use((req, res, next) => {
  req.usuario = { id: 'test-user', nombre: 'Test User' };
  next();
});

app.use('/api/eventos', eventoRoutes);

describe('API de Eventos', () => {
  let clienteTest;
  let empleadoTest;

  beforeAll(async () => {
    await connectMongo(process.env.MONGODB_URI);
    
    // Crear cliente y empleado para las relaciones
    clienteTest = await ClienteModel.add({
      nombre: 'Cliente Evento Test',
      email: 'cliente-evento@test.com',
      empresa: 'Test SA'
    });

    empleadoTest = await EmpleadoModel.add({
      nombre: 'Empleado Evento Test',
      rol: 'planner',
      area: 'PlanificaciÃ³n y Finanzas',
      email: 'empleado-evento@test.com'
    });
  });

  afterAll(async () => {
    if (clienteTest) await ClienteModel.remove(clienteTest.id);
    if (empleadoTest) await EmpleadoModel.remove(empleadoTest.id);
    await disconnectMongo();
  });

  beforeEach(async () => {
    if (mongoose.connection.collections.eventos) {
      await mongoose.connection.collections.eventos.deleteMany({});
    }
  });

  describe('POST /api/eventos', () => {
    it('debe crear un evento completo', async () => {
      const nuevoEvento = {
        nombre: 'Conferencia Anual 2025',
        descripcion: 'Evento corporativo anual',
        fechaInicio: new Date('2025-12-15'),
        fechaFin: new Date('2025-12-16'),
        lugar: 'Hotel Sheraton',
        presupuesto: 50000,
        tipo: 'conferencia',
        estado: 'pendiente',
        clienteId: clienteTest.id,
        empleadoId: empleadoTest.id
      };

      const response = await request(app)
        .post('/api/eventos')
        .send(nuevoEvento);

      expect(response.status).toBe(201);
      expect(response.body.mensaje).toBe('Evento creado');
      expect(response.body.evento.nombre).toBe('Conferencia Anual 2025');
      expect(response.body.evento.tipo).toBe('conferencia');
    });

    it('debe crear evento sin cliente ni empleado asignado', async () => {
      const evento = {
        nombre: 'Evento Simple',
        fechaInicio: new Date('2025-11-20'),
        fechaFin: new Date('2025-11-21'),
        lugar: 'Centro Cultural'
      };

      const response = await request(app)
        .post('/api/eventos')
        .send(evento);

      expect(response.status).toBe(201);
      // Verificar que cuando no hay cliente asociado, el campo quede en null
      expect(response.body.evento.clienteId).toBeNull();
    });

    it('debe fallar sin nombre', async () => {
      const eventoInvalido = {
        fechaInicio: new Date('2025-12-01'),
        lugar: 'Sin nombre'
      };

      const response = await request(app)
        .post('/api/eventos')
        .send(eventoInvalido);

      expect(response.status).toBe(400);
    });
  });

  describe('GET /api/eventos', () => {
    it('debe listar todos los eventos', async () => {
      // Crear varios eventos
      await request(app).post('/api/eventos').send({
        nombre: 'Evento 1',
        fechaInicio: new Date('2025-11-01'),
        fechaFin: new Date('2025-11-02'),
        lugar: 'Lugar 1'
      });

      await request(app).post('/api/eventos').send({
        nombre: 'Evento 2',
        fechaInicio: new Date('2025-11-10'),
        fechaFin: new Date('2025-11-11'),
        lugar: 'Lugar 2'
      });

      const response = await request(app).get('/api/eventos');

      expect(response.status).toBe(200);
      expect(Array.isArray(response.body)).toBe(true);
      expect(response.body.length).toBe(2);
    });
  });

  describe('PUT /api/eventos/:id', () => {
    it('debe actualizar un evento', async () => {
      const eventoCreado = await request(app).post('/api/eventos').send({
        nombre: 'Evento Original',
        fechaInicio: new Date('2025-12-01'),
        fechaFin: new Date('2025-12-02'),
        lugar: 'Lugar Original',
        estado: 'pendiente'
      });

      const eventoId = eventoCreado.body.evento.id;

      const response = await request(app)
        .put(`/api/eventos/${eventoId}`)
        .send({
          nombre: 'Evento Actualizado',
          fechaInicio: new Date('2025-12-01'),
          fechaFin: new Date('2025-12-02'),
          lugar: 'Nuevo Lugar',
          estado: 'activo'
        });

      expect(response.status).toBe(200);
      expect(response.body.evento.nombre).toBe('Evento Actualizado');
      expect(response.body.evento.estado).toBe('activo');
    });
  });

  describe('GET /api/eventos/:id', () => {
    it('debe obtener un evento con relaciones pobladas', async () => {
      const eventoCreado = await request(app).post('/api/eventos').send({
        nombre: 'Evento con Relaciones',
        fechaInicio: new Date('2025-12-01'),
        fechaFin: new Date('2025-12-02'),
        lugar: 'Centro de Eventos',
        clienteId: clienteTest.id,
        empleadoId: empleadoTest.id
      });

      const eventoId = eventoCreado.body.evento.id;

      const response = await request(app).get(`/api/eventos/${eventoId}`);

      expect(response.status).toBe(200);
      expect(response.body.nombre).toBe('Evento con Relaciones');
      // Verificar que las relaciones estÃ¡n pobladas
      expect(response.body.clienteId).toBeDefined();
      expect(response.body.empleadoId).toBeDefined();
    });
  });
});

=====================================================

# Archivo: tests\setup.js

// tests/setup.js
// ConfiguraciÃ³n global para tests

import { jest } from '@jest/globals';
import dotenv from 'dotenv';

// Cargar variables de entorno
dotenv.config();

// Aumentar timeout para operaciones de base de datos
jest.setTimeout(30000);

// Silenciar logs durante tests (opcional)
const originalConsole = global.console;

global.console = {
  ...originalConsole,
  log: jest.fn(),
  debug: jest.fn(),
  info: jest.fn(),
  warn: jest.fn(),
  error: jest.fn(),
};

=====================================================

# Archivo: tests\tareas.test.js

// tests/tareas.test.js
import request from 'supertest';
import express from 'express';
import mongoose from 'mongoose';
import tareaRoutes from '../routes/tareaRoutes.js';
import EmpleadoModel from '../models/EmpleadoModel.js';
import EventoModel from '../models/EventoModel.js';
import { connectMongo, disconnectMongo } from '../db/mongoose.js';

const app = express();
app.use(express.json());

// Mock de autenticaciÃ³n
app.use((req, res, next) => {
  req.usuario = { id: 'test-user', nombre: 'Test User' };
  next();
});

app.use('/api/tareas', tareaRoutes);

describe('API de Tareas', () => {
  let empleadoTest;
  let eventoTest;

  beforeAll(async () => {
    await connectMongo(process.env.MONGODB_URI);
    
    // Crear empleado y evento de prueba para las tareas
    empleadoTest = await EmpleadoModel.add({
      nombre: 'Empleado Test',
      rol: 'coordinador',
      area: 'ProducciÃ³n y LogÃ­stica',
      email: 'empleado@test.com'
    });

    // Crear un evento de prueba para asociarlo a las tareas que se crearÃ¡n en los tests
    eventoTest = await EventoModel.add({
      nombre: 'Evento Test',
      descripcion: 'Evento de prueba',
      fechaInicio: new Date('2025-12-01'),
      fechaFin: new Date('2025-12-02'),
      lugar: 'Centro de Convenciones'
    });

    // Mostrar IDs creados para diagnÃ³stico en caso de error
    console.log('Empleado Test creado:', empleadoTest?.id);
    console.log('Evento Test creado:', eventoTest?.id);
  });

  afterAll(async () => {
    // Limpiar datos de prueba
    if (empleadoTest) await EmpleadoModel.remove(empleadoTest.id);
    if (eventoTest) await EventoModel.remove(eventoTest.id);
    await disconnectMongo();
  });

  beforeEach(async () => {
    // Limpiar tareas antes de cada test
    if (mongoose.connection.collections.tareas) {
      await mongoose.connection.collections.tareas.deleteMany({});
    }
  });

  describe('POST /api/tareas', () => {
    it('debe crear una tarea vÃ¡lida', async () => {
      // Verificar que los datos existen antes de usarlos
      expect(empleadoTest).not.toBeNull();
      expect(eventoTest).not.toBeNull();
      expect(empleadoTest.id).toBeDefined();
      expect(eventoTest.id).toBeDefined();

      const nuevaTarea = {
        titulo: 'Tarea de Prueba',
        descripcion: 'DescripciÃ³n de prueba',
        estado: 'pendiente',
        prioridad: 'alta',
        area: 'ProducciÃ³n y LogÃ­stica',
        tipo: 'CoordinaciÃ³n con proveedores',
        empleadoAsignado: empleadoTest.id,
        eventoAsignado: eventoTest.id,
        horasEstimadas: 8
      };

      const response = await request(app)
        .post('/api/tareas')
        .send(nuevaTarea);

      expect(response.status).toBe(201);
      expect(response.body.mensaje).toBe('Tarea creada');
      expect(response.body.tarea.titulo).toBe('Tarea de Prueba');
    });

    it('debe validar el tipo de tarea segÃºn el Ã¡rea', async () => {
      const tareaInvalida = {
        titulo: 'Tarea InvÃ¡lida',
        area: 'ProducciÃ³n y LogÃ­stica',
        tipo: 'Carga y control del presupuesto del evento' // Este tipo es de PlanificaciÃ³n
      };

      const response = await request(app)
        .post('/api/tareas')
        .send(tareaInvalida);

      expect(response.status).toBe(400);
      expect(response.body.mensaje).toContain('invÃ¡lida');
    });

    it('debe crear tarea sin empleado asignado', async () => {
      const tarea = {
        titulo: 'Tarea sin empleado',
        area: 'PlanificaciÃ³n y Finanzas',
        tipo: 'Firma de contratos con clientes/proveedores',
        estado: 'pendiente',
        prioridad: 'media'
      };

      const response = await request(app)
        .post('/api/tareas')
        .send(tarea);

      expect(response.status).toBe(201);
      expect(response.body.tarea.empleadoAsignado).toBeNull();
    });
  });

  describe('GET /api/tareas', () => {
    beforeEach(async () => {
      // Crear mÃºltiples tareas para filtros
      await request(app).post('/api/tareas').send({
        titulo: 'Tarea Pendiente',
        area: 'ProducciÃ³n y LogÃ­stica',
        tipo: 'Montaje de escenario o mobiliario',
        estado: 'pendiente',
        prioridad: 'alta'
      });

      await request(app).post('/api/tareas').send({
        titulo: 'Tarea En Proceso',
        area: 'PlanificaciÃ³n y Finanzas',
        tipo: 'Seguimiento del cronograma y fechas clave',
        estado: 'en proceso',
        prioridad: 'baja'
      });

      await request(app).post('/api/tareas').send({
        titulo: 'Tarea Finalizada',
        area: 'ProducciÃ³n y LogÃ­stica',
        tipo: 'VerificaciÃ³n tÃ©cnica previa al evento',
        estado: 'finalizada',
        prioridad: 'media'
      });
    });

    it('debe listar todas las tareas', async () => {
      const response = await request(app).get('/api/tareas');

      expect(response.status).toBe(200);
      expect(Array.isArray(response.body)).toBe(true);
      expect(response.body.length).toBe(3);
    });

    it('debe filtrar tareas por estado', async () => {
      const response = await request(app)
        .get('/api/tareas')
        .query({ estado: 'pendiente' });

      expect(response.status).toBe(200);
      expect(response.body.length).toBe(1);
      expect(response.body[0].estado).toBe('pendiente');
    });

    it('debe filtrar tareas por prioridad', async () => {
      const response = await request(app)
        .get('/api/tareas')
        .query({ prioridad: 'alta' });

      expect(response.status).toBe(200);
      expect(response.body.length).toBe(1);
      expect(response.body[0].prioridad).toBe('alta');
    });

    it('debe filtrar tareas por empleado asignado', async () => {
      // Verificar que empleadoTest existe
      expect(empleadoTest).not.toBeNull();
      expect(empleadoTest.id).toBeDefined();

      // Crear tarea con empleado especÃ­fico
      await request(app).post('/api/tareas').send({
        titulo: 'Tarea con Empleado',
        area: 'ProducciÃ³n y LogÃ­stica',
        tipo: 'CoordinaciÃ³n con proveedores',
        empleadoAsignado: empleadoTest.id
      });

      const response = await request(app)
        .get('/api/tareas')
        .query({ empleadoAsignado: empleadoTest.id });

      expect(response.status).toBe(200);
      expect(response.body.length).toBeGreaterThan(0);
    });
  });

  describe('PUT /api/tareas/:id', () => {
    it('debe actualizar una tarea existente', async () => {
      // Crear tarea
      const tareaCreada = await request(app).post('/api/tareas').send({
        titulo: 'Tarea Original',
        area: 'ProducciÃ³n y LogÃ­stica',
        tipo: 'CoordinaciÃ³n con proveedores',
        estado: 'pendiente'
      });

      const tareaId = tareaCreada.body.tarea.id;

      // Actualizar tarea
      const response = await request(app)
        .put(`/api/tareas/${tareaId}`)
        .send({
          titulo: 'Tarea Actualizada',
          area: 'ProducciÃ³n y LogÃ­stica',
          tipo: 'CoordinaciÃ³n con proveedores',
          estado: 'en proceso'
        });

      expect(response.status).toBe(200);
      expect(response.body.tarea.titulo).toBe('Tarea Actualizada');
      expect(response.body.tarea.estado).toBe('en proceso');
    });
  });

  describe('DELETE /api/tareas/:id', () => {
    it('debe eliminar una tarea existente', async () => {
      // Crear tarea
      const tareaCreada = await request(app).post('/api/tareas').send({
        titulo: 'Tarea a Eliminar',
        area: 'PlanificaciÃ³n y Finanzas',
        tipo: 'Carga y control del presupuesto del evento'
      });

      const tareaId = tareaCreada.body.tarea.id;

      // Eliminar tarea
      const response = await request(app).delete(`/api/tareas/${tareaId}`);

      expect(response.status).toBe(200);
      expect(response.body.mensaje).toBe('Tarea eliminada');

      // Verificar que no existe
      const verificar = await request(app).get(`/api/tareas/${tareaId}`);
      expect(verificar.status).toBe(404);
    });
  });
});

=====================================================

# Archivo: views\auth\login.pug

//- views/auth/login.pug
extends ../layout/layout

block content
  .container
    .row.justify-content-center.mt-5
      .col-md-5
        .card.shadow
          .card-body.p-5
            h2.text-center.mb-4
              i.bi.bi-lock-fill.text-primary
              |  Iniciar SesiÃ³n
            
            if error
              .alert.alert-danger.alert-dismissible.fade.show(role='alert')
                i.bi.bi-exclamation-triangle-fill
                |  #{error}
                button.btn-close(type='button' data-bs-dismiss='alert')

            form(method='POST' action='/auth/login')
              .mb-3
                label.form-label(for='email') Email
                input#email.form-control(
                  type='email'
                  name='email'
                  placeholder='tu@email.com'
                  required
                )

              .mb-3
                label.form-label(for='password') ContraseÃ±a
                input#password.form-control(
                  type='password'
                  name='password'
                  placeholder='â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢'
                  required
                )

              .d-grid.gap-2
                button.btn.btn-primary.btn-lg(type='submit')
                  i.bi.bi-box-arrow-in-right
                  |  Iniciar SesiÃ³n

            hr.my-4

            .text-center
              p.text-muted Â¿No tienes cuenta?
              a.btn.btn-outline-secondary(href='/auth/registro')
                i.bi.bi-person-plus
                |  Registrarse

=====================================================

# Archivo: views\auth\perfil.pug

//- views/auth/perfil.pug
extends ../layout/layout

block content
  .container.mt-5
    .row.justify-content-center
      .col-md-8
        .card.shadow
          .card-header.bg-primary.text-white
            h3
              i.bi.bi-person-circle
              |  Mi Perfil

          .card-body.p-4
            .row
              .col-md-4.text-center
                .mb-3
                  i.bi.bi-person-circle.display-1.text-primary

                .badge.bg-info.fs-6.mb-2= usuario.rol.toUpperCase()
                
              .col-md-8
                h4.mb-4= usuario.nombre

                .mb-3
                  strong
                    i.bi.bi-envelope-fill.text-primary
                    |  Email:
                  p.text-muted.ms-4= usuario.email

                .mb-3
                  strong
                    i.bi.bi-briefcase-fill.text-success
                    |  Ãrea:
                  p.text-muted.ms-4= usuario.area

                .mb-3
                  strong
                    i.bi.bi-shield-fill.text-warning
                    |  Rol:
                  p.text-muted.ms-4= usuario.rol

                hr.my-4

                .d-grid.gap-2
                  a.btn.btn-outline-primary(href='/auth/editar-perfil')
                    i.bi.bi-pencil-square
                    |  Editar Perfil
                  
                  a.btn.btn-outline-danger(href='/auth/logout')
                    i.bi.bi-box-arrow-right
                    |  Cerrar SesiÃ³n

=====================================================

# Archivo: views\auth\registro.pug

//- views/auth/registro.pug
extends ../layout/layout

block content
  .container
    .row.justify-content-center.mt-5
      .col-md-6
        .card.shadow
          .card-body.p-5
            h2.text-center.mb-4
              i.bi.bi-person-plus-fill.text-success
              |  Crear Cuenta
            
            if error
              .alert.alert-danger.alert-dismissible.fade.show(role='alert')
                i.bi.bi-exclamation-triangle-fill
                |  #{error}
                button.btn-close(type='button' data-bs-dismiss='alert')

            form(method='POST' action='/auth/registro')
              .mb-3
                label.form-label(for='nombre') Nombre Completo
                input#nombre.form-control(
                  type='text'
                  name='nombre'
                  placeholder='Juan PÃ©rez'
                  required
                )

              .mb-3
                label.form-label(for='email') Email
                input#email.form-control(
                  type='email'
                  name='email'
                  placeholder='tu@email.com'
                  required
                )

              .row
                .col-md-6.mb-3
                  label.form-label(for='password') ContraseÃ±a
                  input#password.form-control(
                    type='password'
                    name='password'
                    placeholder='MÃ­nimo 6 caracteres'
                    minlength='6'
                    required
                  )

                .col-md-6.mb-3
                  label.form-label(for='passwordConfirm') Confirmar
                  input#passwordConfirm.form-control(
                    type='password'
                    name='passwordConfirm'
                    placeholder='Repite la contraseÃ±a'
                    required
                  )

              .mb-3
                label.form-label(for='rol') ðŸ‘” Rol
                select#rol.form-select(name='rol' required)
                  option(value='') Selecciona un rol
                  option(value='coordinador') Coordinador
                  option(value='planner') Planner
                  option(value='administrador') Administrador

              .mb-3
                label.form-label(for='area') ðŸ¢ Ãrea
                select#area.form-select(name='area' required)
                  option(value='') Selecciona un Ã¡rea
                  option(value='ProducciÃ³n y LogÃ­stica') ProducciÃ³n y LogÃ­stica
                  option(value='PlanificaciÃ³n y Finanzas') PlanificaciÃ³n y Finanzas
                  option(value='AtenciÃ³n al Cliente') AtenciÃ³n al Cliente
                  option(value='AdministraciÃ³n') AdministraciÃ³n

              .d-grid.gap-2
                button.btn.btn-success.btn-lg(type='submit')
                  i.bi.bi-check-circle
                  |  Registrarse

            hr.my-4

            .text-center
              p.text-muted Â¿Ya tienes cuenta?
              a.btn.btn-outline-primary(href='/auth/login')
                i.bi.bi-box-arrow-in-right
                |  Iniciar SesiÃ³n

=====================================================

# Archivo: views\clientes\form.pug

//- views/clientes/form.pug
extends ../layout/layout

block content
  .container.mt-4
    .row.justify-content-center
      .col-md-8
        .card
          .card-header
            h3= formTitle || 'Formulario de Cliente'
          .card-body
            form(method="POST", action=formAction)
              .row
                .col-md-6
                  .mb-3
                    label.form-label(for="nombre") Nombre *
                    input.form-control#nombre(type="text", name="nombre", value=cliente ? cliente.nombre : '', required)
                .col-md-6
                  .mb-3
                    label.form-label(for="empresa") Empresa
                    input.form-control#empresa(type="text", name="empresa", value=cliente ? cliente.empresa : '')
              
              .row
                .col-md-6
                  .mb-3
                    label.form-label(for="email") Email *
                    input.form-control#email(type="email", name="email", value=cliente ? cliente.email : '', required)
                .col-md-6
                  .mb-3
                    label.form-label(for="telefono") TelÃ©fono
                    input.form-control#telefono(type="tel", name="telefono", value=cliente ? cliente.telefono : '')
              
              .mb-3
                label.form-label(for="tipo") Tipo de cliente
                select.form-select#tipo(name="tipo")
                  option(value="individual", selected=(cliente && cliente.tipo === 'individual')) Individual
                  option(value="empresa", selected=(cliente && cliente.tipo === 'empresa')) Empresa
              
              .d-flex.gap-2
                button.btn.btn-primary(type="submit")
                  i.bi.bi-check-circle.me-2
                  = cliente ? 'Actualizar' : 'Crear'
                a.btn.btn-secondary(href="/clientes")
                  i.bi.bi-arrow-left.me-2
                  | Cancelar

=====================================================

# Archivo: views\clientes\index.pug

//- views/clientes/index.pug
extends ../layout/layout

block content
  .d-flex.justify-content-between.flex-wrap.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom
    .d-flex.align-items-center
      .me-3
        i.bi.bi-people-fill.fs-1.text-primary
      div
        h1.mb-0 GestiÃ³n de Clientes
        p.lead.mb-0.text-muted Administra tu cartera de clientes
    
    .btn-toolbar.mb-2.mb-md-0
      a.btn.btn-primary(href="/clientes/nuevo")
        i.bi.bi-plus-circle.me-2
        | Nuevo Cliente

  //- Filtros y bÃºsqueda
  .card.mb-4
    .card-body
      .row
        .col-md-8
          .input-group
            input.form-control(type="text", placeholder="Buscar cliente...", id="searchInput")
            button.btn.btn-outline-primary(type="button", id="searchBtn")
              i.bi.bi-search.me-2
              | Buscar
        .col-md-4
          select.form-select#filterType
            option(value="all") Todos los tipos
            option(value="empresa") Empresas
            option(value="individual") Individuales

  //- Tabla de clientes
  .card
    .card-body
      if clientes && clientes.length > 0
        .table-responsive
          table.table.table-hover
            thead
              tr.encabezado-tabla
                th ID
                th Nombre
                th Empresa
                th Contacto
                th Tipo
                th Acciones
            tbody
              each cliente in clientes
                tr
                  td= cliente.id
                  td= cliente.nombre
                  td= cliente.empresa || 'Sin empresa'
                  td
                    div= cliente.email
                    small.text-muted= cliente.telefono || 'Sin telÃ©fono'
                  td
                    span.badge(class=cliente.tipo === 'empresa' ? 'bg-primary' : 'bg-success')= cliente.tipo
                  td
                    .btn-group-group.btn-group-sm
                      a.btn.btn-sm.btn-outline-success(href=`/clientes/${cliente.id}`)
                        i.bi.bi-eye
                      a.btn.btn-sm.btn-outline-primary(href=`/clientes/editar/${cliente.id}`)
                        i.bi.bi-pencil
                      //- Arreglo clave: ID entre comillas
                      button.btn.btn-sm.btn-outline-danger(
                        type="button",
                        onclick=`confirmDelete('${cliente.id}')`
                      )
                        i.bi.bi-trash
      else
        .text-center.py-5
          i.bi.bi-people.fs-1.text-muted
          p.mt-3 No hay clientes registrados
          a.btn.btn-primary(href="/clientes/nuevo") Agregar primer cliente

  //- Toast de notificaciÃ³n (opcional, mejora visual)
  div#toastContainer.position-fixed.bottom-0.end-0.p-3(style="z-index: 1055")
    .toast(role="alert" aria-live="assertive" aria-atomic="true")
      .toast-header
        strong.me-auto Eventify
        small.text-muted Justo ahora
        button.btn-close(type="button", data-bs-dismiss="toast", aria-label="Cerrar")
      .toast-body#toastBody Cliente eliminado correctamente

block scripts
  script.
    // Muestra un toast Bootstrap (en lugar de alert)
    function showToast(message) {
      const toastBody = document.getElementById('toastBody');
      const toastEl = document.querySelector('.toast');
      if (toastBody) toastBody.textContent = message;
      const toast = new bootstrap.Toast(toastEl);
      toast.show();
    }

    // FunciÃ³n para confirmar y eliminar
    function confirmDelete(id) {
      if (confirm('Â¿EstÃ¡s seguro de eliminar este cliente?')) {
        fetch(`/clientes/${id}?_method=DELETE`, { method: 'POST' })
          .then(response => {
            if (response.redirected) {
              // Express redirige despuÃ©s de borrar
              window.location.href = response.url;
            } else {
              return response.json();
            }
          })
          .then(data => {
            if (data?.mensaje) {
              showToast(data.mensaje);
              setTimeout(() => location.reload(), 1200);
            }
          })
          .catch(error => console.error('Error:', error));
      }
    }


  //- Solo funciones especÃ­ficas de clientes
  script.
    function confirmDelete(id) {
      if (confirm('Â¿EstÃ¡s seguro de eliminar este cliente?')) {
        fetch(`/clientes/${id}?_method=DELETE`, { method: 'POST' })
          .then(response => {
            if (response.redirected) {
              window.location.href = response.url;
            }
          })
          .catch(error => console.error('Error:', error));
      }
    }


=====================================================

# Archivo: views\clientes\show.pug

//- views/clientes/show.pug
extends ../layout/layout

block content
  .row.justify-content-center
    .col-lg-8
      .card
        .card-header.d-flex.justify-content-between.align-items-center
          h3.mb-0
            i.bi.bi-person.me-2
            | Detalle del Cliente
          .btn-group
            a.btn.btn-outline-secondary(href="/clientes/editar/" + cliente.id)
              i.bi.bi-pencil.me-2
              | Editar
            a.btn.btn-outline-primary(href="/clientes")
              i.bi.bi-arrow-left.me-2
              | Volver
        
        .card-body
          .row
            .col-md-3.text-center
              .avatar-placeholder.bg-primary.text-white.rounded-circle.mx-auto.mb-3(style="width: 80px; height: 80px; line-height: 80px; font-size: 2rem;")
                i.bi.bi-person
              h5= cliente.nombre
              span.badge(class=cliente.tipo === 'empresa' ? 'bg-primary' : 'bg-success')= cliente.tipo
            
            .col-md-9
              .row
                .col-md-6
                  h6 InformaciÃ³n de contacto
                  p
                    strong Email: 
                    br
                    = cliente.email
                  if cliente.telefono
                    p
                      strong TelÃ©fono: 
                      br
                      = cliente.telefono
                
                .col-md-6
                  h6 InformaciÃ³n adicional
                  if cliente.empresa
                    p
                      strong Empresa: 
                      br
                      = cliente.empresa
                  p
                    strong ID: 
                    br
                    = cliente.id
                  p
                    strong Estado: 
                    span.badge.bg-success Activo
          if eventos && eventos.length > 0
            hr
            h5 Eventos relacionados
            ul.list-group
              each evento in eventos
                li.list-group-item
                  a(href=`/eventos/ver/${evento.id}`)= evento.nombre
                  if evento.lugar
                    small.text-muted.d-block= evento.lugar

=====================================================

# Archivo: views\empleados\form.pug

//- views/empleados/form.pug
extends ../layout/layout

block content
  .row.justify-content-center
    .col-md-8
      .card.shadow
        .card-header.bg-warning.text-white
          h4.mb-0
            i.bi.bi-person-badge.me-2
            = formTitle

        .card-body
          if error
            .alert.alert-danger.alert-dismissible.fade.show(role='alert')
              i.bi.bi-exclamation-triangle-fill.me-2
              = error
              button.btn-close(type='button' data-bs-dismiss='alert')

          form(method='POST' action=formAction)
            .row
              .col-md-6.mb-3
                label.form-label(for='nombre')
                  i.bi.bi-person.me-1
                  | Nombre Completo *
                input#nombre.form-control(
                  type='text'
                  name='nombre'
                  value=empleado ? empleado.nombre : ''
                  required
                  placeholder='Juan PÃ©rez'
                )

              .col-md-6.mb-3
                label.form-label(for='rol')
                  i.bi.bi-award.me-1
                  | Rol *
                select#rol.form-select(name='rol' required)
                  option(value='' selected=!empleado) Selecciona un rol
                  option(value='administrador' selected=empleado && empleado.rol === 'administrador') Administrador
                  option(value='planner' selected=empleado && empleado.rol === 'planner') Planner
                  option(value='coordinador' selected=empleado && empleado.rol === 'coordinador') Coordinador

            .mb-3
              label.form-label(for='area')
                i.bi.bi-building.me-1
                | Ãrea *
              select#area.form-select(name='area' required)
                option(value='' selected=!empleado) Selecciona un Ã¡rea
                option(value='ProducciÃ³n y LogÃ­stica' selected=empleado && empleado.area === 'ProducciÃ³n y LogÃ­stica') ProducciÃ³n y LogÃ­stica
                option(value='PlanificaciÃ³n y Finanzas' selected=empleado && empleado.area === 'PlanificaciÃ³n y Finanzas') PlanificaciÃ³n y Finanzas
                option(value='AtenciÃ³n al Cliente' selected=empleado && empleado.area === 'AtenciÃ³n al Cliente') AtenciÃ³n al Cliente
                option(value='AdministraciÃ³n' selected=empleado && empleado.area === 'AdministraciÃ³n') AdministraciÃ³n

            .row
              .col-md-6.mb-3
                label.form-label(for='email')
                  i.bi.bi-envelope.me-1
                  | Email
                input#email.form-control(
                  type='email'
                  name='email'
                  value=empleado ? empleado.email : ''
                  placeholder='ejemplo@eventify.com'
                )

              .col-md-6.mb-3
                label.form-label(for='telefono')
                  i.bi.bi-phone.me-1
                  | TelÃ©fono
                input#telefono.form-control(
                  type='tel'
                  name='telefono'
                  value=empleado ? empleado.telefono : ''
                  placeholder='+54 11 1234-5678'
                )

            hr.my-4

            .d-flex.justify-content-between
              a.btn.btn-secondary(href='/empleados')
                i.bi.bi-arrow-left.me-1
                | Volver
              
              button.btn.btn-warning(type='submit')
                i.bi.bi-check-circle.me-1
                | Guardar

=====================================================

# Archivo: views\empleados\index.pug

//- views/empleados/index.pug
extends ../layout/layout

block content
  .d-flex.justify-content-between.align-items-center.mb-4
    h2
      i.bi.bi-person-badge.text-warning.me-2
      | Empleados
    a.btn.btn-warning(href="/empleados/crear")
      i.bi.bi-plus-circle.me-1
      | Nuevo Empleado

  // Filtros y bÃºsqueda
  .card.mb-4
    .card-body
      .row
        .col-md-8
          .input-group
            input.form-control(type="text", placeholder="Buscar empleado por nombre, Ã¡rea o email...", id="searchInput")
            button.btn.btn-outline-primary(type="button", id="searchBtn")
              i.bi.bi-search.me-2
              | Buscar
        .col-md-4
          select.form-select#filterRole
            option(value="all") Todos los roles
            option(value="administrador") administrador
            option(value="planner") planner
            option(value="coordinador") coordinador

  .card.shadow
    .card-body
      if empleados && empleados.length > 0
        .table-responsive
          table.table.table-hover
            thead.table-light
              tr
                th #
                th Nombre
                th Rol
                th Ãrea
                th Email
                th TelÃ©fono
                th Acciones
            tbody
              each empleado, index in empleados
                tr
                  td= index + 1
                  td
                    strong= empleado.nombre
                  td
                    span.badge(
                      class=empleado.rol === 'administrador' ? 'bg-danger' : empleado.rol === 'planner' ? 'bg-primary' : 'bg-info'
                    )= empleado.rol
                  td= empleado.area
                  td
                    if empleado.email
                      a(href=`mailto:${empleado.email}`)= empleado.email
                    else
                      span.text-muted N/A
                  td= empleado.telefono || 'N/A'
                  td
                    .btn-group(role='group')
                      a.btn.btn-sm.btn-outline-primary(
                        href=`/empleados/editar/${empleado.id}`
                        title='Editar'
                      )
                        i.bi.bi-pencil
                      a.btn.btn-sm.btn-outline-secondary(href=`/empleados/${empleado.id}` title='Ver')
                        i.bi.bi-eye
                      
                      form.d-inline(
                        method='POST'
                        action=`/empleados/eliminar/${empleado.id}`
                        onsubmit='return confirm("Â¿Eliminar este empleado?")'
                      )
                        button.btn.btn-sm.btn-outline-danger(type='submit' title='Eliminar')
                          i.bi.bi-trash
      else
        .text-center.py-5
          i.bi.bi-person-x.fs-1.text-muted.d-block.mb-3
          p.text-muted No hay empleados registrados
          a.btn.btn-warning(href="/empleados/crear") Crear primer empleado

=====================================================

# Archivo: views\empleados\show.pug

extends ../layout/layout

block content
  .row.justify-content-center
    .col-lg-8
      .card
        .card-header.d-flex.justify-content-between.align-items-center
          h3.mb-0
            i.bi.bi-person-badge.me-2
            | Detalle del Empleado
          .btn-group
            a.btn.btn-outline-secondary(href=`/empleados/editar/${empleado.id}`)
              i.bi.bi-pencil.me-2
              | Editar
            a.btn.btn-outline-primary(href="/empleados")
              i.bi.bi-arrow-left.me-2
              | Volver

        .card-body
          .row
            .col-md-4.text-center
              .avatar-placeholder.bg-primary.text-white.rounded-circle.mx-auto.mb-3(style="width: 80px; height: 80px; line-height: 80px; font-size: 2rem;")
                i.bi.bi-person
              h5= empleado.nombre
              span.badge(class=empleado.rol === 'administrador' ? 'bg-danger' : empleado.rol === 'planner' ? 'bg-primary' : 'bg-info')= empleado.rol

            .col-md-8
              dl.row
                dt.col-md-4 Ãrea
                dd.col-md-8= empleado.area

                dt.col-md-4 Email
                dd.col-md-8
                  if empleado.email
                    a(href=`mailto:${empleado.email}`)= empleado.email
                  else
                    span.text-muted N/A

                dt.col-md-4 TelÃ©fono
                dd.col-md-8= empleado.telefono || 'N/A'

          if tareas && tareas.length > 0
            hr
            h5 Tareas asignadas
            ul.list-group
              each tarea in tareas
                li.list-group-item
                  a(href=`/tareas/${tarea.id}`)= tarea.titulo
                  if tarea.estado
                    span.badge.ms-2(class=tarea.estado === 'pendiente' ? 'bg-warning' : tarea.estado === 'en proceso' ? 'bg-info' : 'bg-success')= tarea.estado
          else
            hr
            p.text-muted No hay tareas asignadas a este empleado.


=====================================================

# Archivo: views\error.pug

extends layout/layout

block content
  .container.mt-5.text-center
    h1.text-danger #{title || 'Error inesperado'}
    p.lead.mt-3 #{message || 'OcurriÃ³ un error en el servidor.'}

    a.btn.btn-primary.mt-4(href='/') Volver al inicio


=====================================================

# Archivo: views\eventos\componentes\formulario-evento.pug

- const eventData = evento || {}
- const formAction = actionUrl || '/eventos/crear'

form#formEvento(method="POST" action=formAction)

  .row
    .col-md-12
      .mb-3
        label.form-label(for="nombre") Nombre del Evento *
        input.form-control(
          type="text" 
          id="nombre" 
          name="nombre" 
          value=eventData.nombre 
          required
          placeholder="Ingresa el nombre del evento"
        )

  .row
    .col-md-6
      .mb-3
        label.form-label(for="tipo") Tipo de Evento
        select.form-select(
          id="tipo" 
          name="tipo"
        )
          option(value="corporativo" selected=eventData.tipo === 'corporativo') Corporativo
          option(value="conferencia" selected=eventData.tipo === 'conferencia') Conferencia
          option(value="workshop" selected=eventData.tipo === 'workshop') Workshop
          option(value="networking" selected=eventData.tipo === 'networking') Networking
          option(value="social" selected=eventData.tipo === 'social') Social
          option(value="deportivo" selected=eventData.tipo === 'deportivo') Deportivo
          option(value="cultural" selected=eventData.tipo === 'cultural') Cultural
          option(value="educativo" selected=eventData.tipo === 'educativo') Educativo
  
    .col-md-6
      .mb-3
        label.form-label(for="estado") Estado
        select.form-select(
          id="estado" 
          name="estado"
        )
          option(value="pendiente" selected=eventData.estado === 'pendiente') Pendiente
          option(value="activo" selected=eventData.estado === 'activo') Activo
          option(value="finalizado" selected=eventData.estado === 'finalizado') Finalizado
          option(value="cancelado" selected=eventData.estado === 'cancelado') Cancelado

  .row
    .col-md-6
      .mb-3
        label.form-label(for="cliente_id") Cliente
        select.form-select(
          id="cliente_id" 
          name="cliente_id"
        )
          option(value="") Seleccionar cliente...
          each cliente in clientes
            option(
              value=cliente.id
              selected=eventData.cliente_id === cliente.id
            )= `${cliente.nombre}${cliente.empresa ? ' - ' + cliente.empresa : ''}`
    
    .col-md-6
      .mb-3
        label.form-label(for="empleado_id") Empleado Responsable
        select.form-select(
          id="empleado_id" 
          name="empleado_id"
        )
          option(value="") Seleccionar empleado...
          each empleado in empleados
            option(
              value=empleado.id
              selected=eventData.empleado_id === empleado.id
            )= `${empleado.nombre} - ${empleado.rol}`
  
  .row
    .col-md-6
      .mb-3
        label.form-label(for="fecha_inicio") Fecha de Inicio
        input.form-control(
          type="datetime-local" 
          id="fecha_inicio" 
          name="fecha_inicio" 
          value=eventData.fecha_inicio ? new Date(eventData.fecha_inicio).toISOString().slice(0,16) : '' 
        )
    
    .col-md-6
      .mb-3
        label.form-label(for="fecha_fin") Fecha de Fin
        input.form-control(
          type="datetime-local" 
          id="fecha_fin" 
          name="fecha_fin" 
          value=eventData.fecha_fin ? new Date(eventData.fecha_fin).toISOString().slice(0,16) : '' 
        )
  
  .mb-3
    label.form-label(for="descripcion") DescripciÃ³n
    textarea.form-control(
      id="descripcion" 
      name="descripcion" 
      rows="3"
      placeholder="Describe el evento..."
    )= eventData.descripcion
  
  .row
    .col-md-8
      .mb-3
        label.form-label(for="lugar") Lugar *
        input.form-control(
          type="text" 
          id="lugar" 
          name="lugar" 
          value=eventData.lugar
          required
          placeholder="Nombre del lugar o sede"
        )
    
    .col-md-4
      .mb-3
        label.form-label(for="precio") Presupuesto
        .input-group
          span.input-group-text $
          input.form-control(
            type="number" 
            id="precio" 
            name="precio" 
            value=eventData.precio || eventData.presupuesto
            step="0.01" 
            min="0"
            placeholder="0.00"
          )
  
  .d-grid.gap-2.d-md-flex.justify-content-md-end
    a.btn.btn-secondary.me-md-2(href="/eventos") Cancelar
    button.btn.btn-primary(type="submit")= eventData._id ? 'Actualizar Evento' : 'Crear Evento'
    

    

=====================================================

# Archivo: views\eventos\componentes\lista-eventos.pug

.card
  .card-body
    if eventos && eventos.length > 0
      .table-responsive
        table.table.table-hover
          thead
            tr
              th Nombre
              th DescripciÃ³n
              th Fecha Inicio
              th Lugar
              th Cliente
              th Empleado Responsable
              th Presupuesto
              th Acciones
          tbody
            each evento in eventos
              tr
                // Nombre
                td
                  strong= evento.nombre

                // DescripciÃ³n (corta)
                td
                  if evento.descripcion
                    = evento.descripcion.substring(0, 50) + (evento.descripcion.length > 50 ? '...' : '')
                  else
                    span.text-muted Sin descripciÃ³n

                // Fecha inicio
                td
                  if evento.fecha_inicio
                    small
                      strong= new Date(evento.fecha_inicio).toLocaleDateString()
                      br
                      span.text-muted= new Date(evento.fecha_inicio).toLocaleTimeString()
                  else
                    span.text-muted No definida

                // Lugar
                td= evento.lugar || 'No especificado'

                // Cliente (con enlace si existe)
                td
                  if evento.cliente
                    a(href=`/clientes/${evento.cliente.id || evento.cliente._id}` ).fw-bold= evento.cliente.nombre || (`Cliente ${String(evento.cliente.id || evento.cliente._id).slice(0,6)}`)
                    if evento.cliente.empresa
                      small.text-muted.d-block= evento.cliente.empresa
                  else
                    span.text-muted No asignado

                // Empleado responsable (con enlace si existe)
                td
                  if evento.empleado
                    a(href=`/empleados/${evento.empleado.id || evento.empleado._id}` ).fw-bold= evento.empleado.nombre || (`Empleado ${String(evento.empleado.id || evento.empleado._id).slice(0,6)}`)
                    small.text-muted.d-block= evento.empleado.rol
                  else
                    span.text-muted No asignado

                // Presupuesto
                td
                  if evento.presupuesto
                    strong $ #{evento.presupuesto.toLocaleString()}
                  else
                    span.text-muted $ 0

                // Acciones: ver / editar / eliminar
                td
                  .btn-group.btn-group-sm(role='group')
                    a.btn.btn-sm.btn-outline-secondary(href=`/eventos/ver/${evento._id || evento.id}` title='Ver')
                      i.bi.bi-eye
                    a.btn.btn-sm.btn-outline-primary(href=`/eventos/editar/${evento._id || evento.id}` title='Editar')
                      i.bi.bi-pencil
                    form.d-inline(method="POST" action=`/eventos/eliminar/${evento._id || evento.id}`)
                      button.btn.btn-sm.btn-outline-danger(type="submit" onclick="return confirm('Â¿EstÃ¡s seguro de eliminar este evento?')")
                        i.bi.bi-trash
    else
      .text-center.py-4
        i.bi.bi-calendar-x.display-1.text-muted
        h5.mt-3 No hay eventos registrados
        p.text-muted Comienza creando tu primer evento.
        a.btn.btn-primary(href="/eventos/crear")
          i.bi.bi-plus-circle
          |  Crear Primer Evento


=====================================================

# Archivo: views\eventos\crear-evento.pug

extends ../layout/layout

block content
  .d-flex.justify-content-between.flex-wrap.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom
    h1.h2 Crear Nuevo Evento
    .btn-toolbar.mb-2.mb-md-0
      a.btn.btn-sm.btn-outline-secondary(href="/eventos")
        i.bi.bi-arrow-left
        |  Volver
  
  .row
    .col-lg-8
      .card
        .card-body
          include componentes/formulario-evento
          

=====================================================

# Archivo: views\eventos\editar-evento.pug

extends ../layout/layout

block content
  .d-flex.justify-content-between.flex-wrap.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom
    h1.h2 Editar Evento
    .btn-toolbar.mb-2.mb-md-0
      a.btn.btn-sm.btn-outline-secondary(href="/eventos")
        i.bi.bi-arrow-left
        |  Volver
  
  //- Mostrar mensajes de error si existen
  if error
    .alert.alert-danger.alert-dismissible.fade.show(role="alert")
      i.bi.bi-exclamation-triangle.me-2
      | #{error}
      button.btn-close(type="button" data-bs-dismiss="alert")

  .row
    .col-lg-8
      .card
        .card-body
          //- Pasar las variables necesarias al formulario
          include componentes/formulario-evento

block scripts
  script.
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Formulario de ediciÃ³n cargado');
      
      // ValidaciÃ³n de fechas
      const form = document.getElementById('formEvento');
      const fechaInicio = document.getElementById('fecha_inicio');
      const fechaFin = document.getElementById('fecha_fin');
      
      if (form && fechaInicio && fechaFin) {
        form.addEventListener('submit', function(e) {
          if (fechaInicio.value && fechaFin.value) {
            const inicio = new Date(fechaInicio.value);
            const fin = new Date(fechaFin.value);
            
            if (fin <= inicio) {
              e.preventDefault();
              alert('La fecha de fin debe ser posterior a la fecha de inicio');
              fechaFin.focus();
            }
          }
        });
      }
    });
    

=====================================================

# Archivo: views\eventos\eventos.pug

extends ../layout/layout

block content
  .d-flex.justify-content-between.flex-wrap.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom
    .d-flex.align-items-center
      .me-3
        i.bi.bi-calendar-event.fs-1.text-primary
      div
        h1.mb-0 GestiÃ³n de Eventos  <!-- Cambiado: h1.mb-0 en lugar de h1.h2.mb-0 -->
        p.lead.mb-0.text-muted Administra y organiza tus eventos
    
    .btn-toolbar.mb-2.mb-md-0
      a.btn.btn-primary(href="/eventos/crear")
        i.bi.bi-plus-circle.me-2
        | Nuevo Evento
  
  //- Filtros y bÃºsqueda
  .card.mb-4
    .card-body
      .row
        .col-md-8
          .input-group
            input.form-control(
              type="text", 
              placeholder="Buscar evento por nombre, lugar o descripciÃ³n...", 
              id="searchInput"
            )
            button.btn.btn-outline-primary(type="button", id="searchBtn")
              i.bi.bi-search.me-2
              | Buscar
        .col-md-4
          select.form-select#filterEstado
            option(value="all") Todos los estados
            option(value="activo") Activos
            option(value="pendiente") Pendientes
            option(value="finalizado") Finalizados
            option(value="cancelado") Cancelados

  .card
    .card-body
      if eventos && eventos.length > 0
        .table-responsive
          table.table.table-hover
            thead
              tr.encabezado-tabla

                th Nombre
                th Tipo
                th Fecha Inicio
                th Lugar
                th Estado
                th Acciones
            tbody
              each evento in eventos
                tr
                  td
                    strong= evento.nombre
                    if evento.descripcion
                      br
                      small.text-muted= evento.descripcion.substring(0, 50) + '...'
                  td
                    span.badge.bg-info.text-dark= evento.tipo ? evento.tipo.charAt(0).toUpperCase() + evento.tipo.slice(1) : 'Corporativo'
                  td
                    small
                      strong= new Date(evento.fecha_inicio).toLocaleDateString()
                      br
                      span.text-muted= new Date(evento.fecha_inicio).toLocaleTimeString()
                  td= evento.lugar
                  td
                    span.badge(class={
                      'bg-success': evento.estado === 'activo',
                      'bg-warning': evento.estado === 'pendiente',
                      'bg-secondary': evento.estado === 'finalizado',
                      'bg-danger': evento.estado === 'cancelado'
                    })
                      = evento.estado ? evento.estado.charAt(0).toUpperCase() + evento.estado.slice(1) : 'Pendiente'
                  td
                    .btn-group-group.btn-group-sm
                      a.btn.btn-sm.btn-outline-secondary(href=`/eventos/ver/${evento._id || evento.id}` title='Ver')
                        i.bi.bi-eye
                      a.btn.btn-sm.btn-outline-primary(href=`/eventos/editar/${evento._id || evento.id}`)
                        i.bi.bi-pencil
                      form.d-inline(method="POST" action=`/eventos/eliminar/${evento._id || evento.id}`)
                        button.btn.btn-sm.btn-outline-danger(type="submit" onclick="return confirm('Â¿EstÃ¡s seguro de eliminar este evento?')")
                          i.bi.bi-trash
      else
        .text-center.py-4
          i.bi.bi-calendar-x.display-1.text-muted
          h5.mt-3 No hay eventos registrados
          p.text-muted Comienza creando tu primer evento.
          a.btn.btn-primary(href="/eventos/crear")
            i.bi.bi-plus-circle
            |  Crear Primer Evento

  if error
    .alert.alert-danger.mt-3
      i.bi.bi-exclamation-triangle
      |  #{error}


block scripts
  script.
    function confirmDelete(eventId, eventName) {
      if (confirm(`Â¿EstÃ¡s seguro de eliminar el evento "${eventName}"?`)) {
        document.querySelector(`form[action="/eventos/eliminar/${eventId}"]`).submit();
      }
    }
    
  script(src="/js/filtros.js")

=====================================================

# Archivo: views\eventos\show.pug

extends ../layout/layout

block content
  .row.justify-content-center
    .col-lg-8
      .card
        .card-header.d-flex.justify-content-between.align-items-center
          h3.mb-0
            i.bi.bi-calendar-event.me-2
            | Detalle del Evento
          .btn-group
            a.btn.btn-outline-secondary(href=`/eventos/editar/${evento.id}`)
              i.bi.bi-pencil.me-2
              | Editar
            a.btn.btn-outline-primary(href="/eventos")
              i.bi.bi-arrow-left.me-2
              | Volver

        .card-body
          .row
            .col-md-12
              h4= evento.nombre
              p.text-muted= evento.tipo + ' Â· ' + (evento.estado || '')
              if evento.descripcion
                p= evento.descripcion
              dl.row
                dt.col-md-3 Fecha Inicio
                dd.col-md-9= evento.fechaInicio ? new Date(evento.fechaInicio).toLocaleString() : 'No definida'

                dt.col-md-3 Fecha Fin
                dd.col-md-9= evento.fechaFin ? new Date(evento.fechaFin).toLocaleString() : 'No definida'

                dt.col-md-3 Lugar
                dd.col-md-9= evento.lugar || 'No especificado'

                dt.col-md-3 Presupuesto
                dd.col-md-9= evento.presupuesto ? `$ ${evento.presupuesto.toLocaleString()}` : '$ 0'

                dt.col-md-3 Cliente
                dd.col-md-9
                  if evento.cliente
                    a(href=`/clientes/${evento.cliente.id || evento.cliente._id}`)= evento.cliente.nombre || (`Cliente ${String(evento.cliente.id || evento.cliente._id).slice(0,6)}`)
                    if evento.cliente.empresa
                      br
                      small.text-muted= evento.cliente.empresa
                  else
                    span.text-muted No asignado

                dt.col-md-3 Empleado Responsable
                dd.col-md-9
                  if evento.empleado
                    a(href=`/empleados/${evento.empleado.id || evento.empleado._id}`)= evento.empleado.nombre || (`Empleado ${String(evento.empleado.id || evento.empleado._id).slice(0,6)}`)
                    br
                    small.text-muted= evento.empleado.rol
                  else
                    span.text-muted No asignado


=====================================================

# Archivo: views\index.pug

//- views/index.pug
extends layout/layout

block content
  //- ðŸŽ¨ Hero Section - Siempre visible
  .hero-section.bg-primary.text-white.py-5
    .container
      .row.align-items-center
        .col-lg-6
          h1.display-4.fw-bold Eventify - Sistema de GestiÃ³n
          p.lead Plataforma integral para la gestiÃ³n de eventos
          
          //- BotÃ³n condicional segÃºn autenticaciÃ³n
          if usuario
            .mt-3
              p.mb-2
                i.bi.bi-check-circle-fill.me-2
                | Bienvenido, #{usuario.nombre}!
              a.btn.btn-light.btn-lg(href="/eventos") 
                i.bi.bi-calendar-event.me-2
                | Ver Eventos
          else
            a.btn.btn-light.btn-lg.mt-3(href="/auth/login") 
              i.bi.bi-arrow-right-circle.me-2
              | Comenzar ahora
        
        .col-lg-6
          img.img-fluid.rounded(
            src="https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80", 
            alt="Sistema de gestiÃ³n de eventos"
          )

  //- ðŸ“Š Dashboard con estadÃ­sticas (solo si hay sesiÃ³n)
  if usuario
    .container.my-5
      .row.mb-4
        .col-12
          h2.text-center.mb-4
            i.bi.bi-speedometer2.text-primary.me-2
            | Dashboard
      
      //- Tarjetas de estadÃ­sticas
      .row.text-center.g-4.mb-5
        .col-md-3
          .card.h-100.border-primary.shadow-sm
            .card-body
              i.bi.bi-calendar-event.fs-1.text-primary.mb-3
              h3.card-title= eventos ? eventos.length : 0
              p.card-text.text-muted Eventos Activos
              a.btn.btn-outline-primary.btn-sm(href='/eventos') Ver todos
        
        .col-md-3
          .card.h-100.border-success.shadow-sm
            .card-body
              i.bi.bi-people-fill.fs-1.text-success.mb-3
              h3.card-title= clientes ? clientes.length : 0
              p.card-text.text-muted Clientes
              a.btn.btn-outline-success.btn-sm(href='/clientes') Ver todos
        
        .col-md-3
          .card.h-100.border-warning.shadow-sm
            .card-body
              i.bi.bi-person-badge.fs-1.text-warning.mb-3
              h3.card-title= empleados ? empleados.length : 0
              p.card-text.text-muted Empleados
              a.btn.btn-outline-warning.btn-sm(href='/empleados') Ver todos
        
        .col-md-3
          .card.h-100.border-info.shadow-sm
            .card-body
              i.bi.bi-list-task.fs-1.text-info.mb-3
              h3.card-title= tareas ? tareas.length : 0
              p.card-text.text-muted Tareas
              a.btn.btn-outline-info.btn-sm(href='/tareas') Ver todos

      //- ðŸš€ Acciones RÃ¡pidas
      .row.mb-5
        .col-12
          .card.shadow
            .card-header.bg-primary.text-white
              h5.mb-0
                i.bi.bi-lightning-charge-fill.me-2
                | Acciones RÃ¡pidas
            .card-body
              .row.g-3
                .col-md-3
                  a.btn.btn-outline-primary.w-100.py-3(href='/eventos/crear')
                    i.bi.bi-plus-circle.fs-4.d-block.mb-2
                    | Nuevo Evento
                
                .col-md-3
                  a.btn.btn-outline-success.w-100.py-3(href='/clientes/nuevo')
                    i.bi.bi-person-plus.fs-4.d-block.mb-2
                    | Nuevo Cliente
                
                .col-md-3
                  a.btn.btn-outline-warning.w-100.py-3(href='/empleados/crear')
                    i.bi.bi-person-badge.fs-4.d-block.mb-2
                    | Nuevo Empleado
                
                .col-md-3
                  a.btn.btn-outline-info.w-100.py-3(href='/tareas/crear')
                    i.bi.bi-clipboard-plus.fs-4.d-block.mb-2
                    | Nueva Tarea

      //- ðŸ“‹ Ãšltimas Actividades
      .row
        .col-md-6.mb-4
          .card.shadow-sm.h-100
            .card-header.bg-light
              h5.mb-0
                i.bi.bi-clock-history.me-2
                | Eventos Recientes
            .card-body
              if eventos && eventos.length > 0
                .list-group.list-group-flush
                  each evento in eventos.slice(0, 5)
                    .list-group-item.d-flex.justify-content-between.align-items-center
                      div
                        strong= evento.nombre
                        br
                        small.text-muted
                          i.bi.bi-geo-alt.me-1
                          = evento.lugar
                      span.badge.bg-primary.rounded-pill= evento.estado || 'Activo'
              else
                .text-center.py-4
                  i.bi.bi-calendar-x.fs-1.text-muted.d-block.mb-2
                  p.text-muted No hay eventos registrados
                  a.btn.btn-primary.btn-sm(href='/eventos/crear') Crear primer evento
        
        .col-md-6.mb-4
          .card.shadow-sm.h-100
            .card-header.bg-light
              h5.mb-0
                i.bi.bi-list-check.me-2
                | Tareas Pendientes
            .card-body
              if tareas && tareas.length > 0
                .list-group.list-group-flush
                  each tarea in tareas.slice(0, 5)
                    .list-group-item.d-flex.justify-content-between.align-items-center
                      div
                        strong= tarea.titulo
                        br
                        small.text-muted= tarea.area
                      span.badge(
                        class=tarea.estado === 'pendiente' ? 'bg-warning' : tarea.estado === 'en proceso' ? 'bg-info' : 'bg-success'
                      )= tarea.estado
              else
                .text-center.py-4
                  i.bi.bi-check-circle.fs-1.text-muted.d-block.mb-2
                  p.text-muted No hay tareas pendientes
                  a.btn.btn-info.btn-sm(href='/tareas/crear') Crear primera tarea

  //- ðŸ“¦ SecciÃ³n de MÃ³dulos (solo si NO hay sesiÃ³n)
  else
    .container.my-5
      .row.mb-4
        .col-12
          h2.text-center.mb-4
            i.bi.bi-grid-3x3-gap-fill.text-primary.me-2
            | MÃ³dulos del Sistema
          p.text-center.text-muted Inicia sesiÃ³n para acceder a todas las funcionalidades
      
      .row.text-center.g-4
        each module in [{name: 'Clientes', icon: 'people-fill', route: '/clientes', color: 'primary', desc: 'Gestiona tu cartera de clientes'}, {name: 'Eventos', icon: 'calendar-event', route: '/eventos', color: 'success', desc: 'Organiza y planifica eventos'}, {name: 'Empleados', icon: 'person-badge', route: '/empleados', color: 'warning', desc: 'Administra tu equipo de trabajo'}, {name: 'Tareas', icon: 'list-task', route: '/tareas', color: 'info', desc: 'Asigna y controla tareas'}]
          .col-md-3.mb-4
            .card.h-100.text-center.shadow-sm
              .card-body
                i.bi(class=`bi-${module.icon} fs-1 text-${module.color} mb-3`)
                h4.card-title= module.name
                p.card-text.text-muted.small= module.desc
                button.btn(class=`btn-outline-${module.color}`, disabled)
                  i.bi.bi-lock-fill.me-1
                  | Requiere SesiÃ³n

      //- ðŸŒŸ Llamado a la acciÃ³n
      .row.mt-5
        .col-12
          .card.shadow-lg.border-0
            .card-body.p-5.text-center
              h3.mb-3
                i.bi.bi-rocket-takeoff.text-primary.me-2
                | Â¿Listo para comenzar?
              p.lead.text-muted Inicia sesiÃ³n para acceder a todas las funcionalidades
              .d-grid.gap-3.d-md-flex.justify-content-md-center.mt-4
                a.btn.btn-primary.btn-lg.px-5(href='/auth/login')
                  i.bi.bi-box-arrow-in-right.me-2
                  | Iniciar SesiÃ³n
                a.btn.btn-outline-success.btn-lg.px-5(href='/auth/registro')
                  i.bi.bi-person-plus.me-2
                  | Crear Cuenta

      //- âœ¨ CaracterÃ­sticas del sistema
      .row.mt-5.g-4
        .col-md-4
          .card.h-100.border-0.shadow-sm
            .card-body.text-center.p-4
              .bg-primary.bg-opacity-10.rounded-circle.d-inline-flex.align-items-center.justify-content-center.mb-3(style='width: 80px; height: 80px;')
                i.bi.bi-shield-check.text-primary.fs-1
              h5 Seguro y Confiable
              p.text-muted Sistema con autenticaciÃ³n y permisos por rol
        
        .col-md-4
          .card.h-100.border-0.shadow-sm
            .card-body.text-center.p-4
              .bg-success.bg-opacity-10.rounded-circle.d-inline-flex.align-items-center.justify-content-center.mb-3(style='width: 80px; height: 80px;')
                i.bi.bi-graph-up-arrow.text-success.fs-1
              h5 GestiÃ³n Eficiente
              p.text-muted Administra eventos, clientes y tareas en un solo lugar
        
        .col-md-4
          .card.h-100.border-0.shadow-sm
            .card-body.text-center.p-4
              .bg-info.bg-opacity-10.rounded-circle.d-inline-flex.align-items-center.justify-content-center.mb-3(style='width: 80px; height: 80px;')
                i.bi.bi-people.text-info.fs-1
              h5 Trabajo en Equipo
              p.text-muted Colabora con tu equipo en tiempo real

=====================================================

# Archivo: views\layout\layout.pug

//- views/layout/layout.pug
doctype html
html(lang="es")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title= title || 'Eventify - Sistema de GestiÃ³n'
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css", rel="stylesheet")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css")
    link(rel="stylesheet", href="/css/styles.css")
    block styles

  body
    //- HEADER con usuario / login
    header.bg-dark.text-white.mb-3
      .container-fluid.d-flex.justify-content-between.align-items-center.py-2
        //- Logo / marca
        a.d-flex.align-items-center.text-decoration-none.text-white(href="/")
          i.bi.bi-calendar-event.fs-4.me-2
          span.fs-5 Eventify

        //- SecciÃ³n de usuario (autenticado o no)
        if usuario
          .dropdown
            button.btn.btn-outline-light.dropdown-toggle(
              type='button'
              data-bs-toggle='dropdown'
              aria-expanded='false'
            )
              i.bi.bi-person-circle.me-1
              |  #{usuario.nombre}
            ul.dropdown-menu.dropdown-menu-end
              li
                .dropdown-item-text
                  small.text-muted= usuario.rol
              li
                hr.dropdown-divider
              li
                a.dropdown-item(href='/auth/perfil')
                  i.bi.bi-person.me-2
                  |  Mi Perfil
              li
                hr.dropdown-divider
              li
                a.dropdown-item.text-danger(
                  href='/auth/logout'
                  onclick='return confirm("Â¿EstÃ¡s seguro que deseas cerrar sesiÃ³n?")'
                )
                  i.bi.bi-box-arrow-right.me-2
                  |  Cerrar SesiÃ³n
        else
          .btn-group(role='group')
            a.btn.btn-outline-light.btn-sm(href='/auth/login')
              i.bi.bi-box-arrow-in-right.me-1
              | Iniciar SesiÃ³n
            a.btn.btn-light.btn-sm(href='/auth/registro')
              i.bi.bi-person-plus.me-1
              | Registrarse

    //- Wrapper flex para sticky footer
    .main-wrapper.d-flex.flex-column.min-vh-100
      .container-fluid.flex-grow-1
        .row
          //- Sidebar
          .col-md-3.col-lg-2.sidebar.p-3
            .text-center.mb-4
              h4 
                i.bi.bi-calendar-event.text-primary.me-2
                | Eventify
              hr
            
            //- InformaciÃ³n de Usuario en Sidebar
            if usuario
              .alert.alert-info.py-2.px-3.mb-3
                .d-flex.align-items-center
                  i.bi.bi-person-circle.fs-3.me-2
                  div
                    strong.d-block= usuario.nombre
                    small.text-muted= usuario.area
            else
              .alert.alert-warning.py-2.px-3.mb-3
                .text-center
                  i.bi.bi-exclamation-triangle.me-1
                  small Sin sesiÃ³n iniciada
            
            ul.nav.flex-column
              li.nav-item
                a.nav-link(class=(currentPath === '/' ? 'active' : ''), href="/")
                  i.bi.bi-house.me-2
                  | Inicio
                  if !usuario
                    |  
                    i.bi.bi-lock-fill.text-warning.small
              
              li.nav-item
                a.nav-link(class=(currentPath && currentPath.startsWith && currentPath.startsWith('/clientes') ? 'active' : ''), href="/clientes")
                  i.bi.bi-people-fill.me-2
                  | Clientes
                  if !usuario
                    |  
                    i.bi.bi-lock-fill.text-warning.small
              
              li.nav-item
                a.nav-link(class=(currentPath && currentPath.startsWith && currentPath.startsWith('/eventos') ? 'active' : ''), href="/eventos")
                  i.bi.bi-calendar-event.me-2
                  | Eventos
                  if !usuario
                    |  
                    i.bi.bi-lock-fill.text-warning.small
              
              li.nav-item
                a.nav-link(class=(currentPath && currentPath.startsWith && currentPath.startsWith('/empleados') ? 'active' : ''), href="/empleados")
                  i.bi.bi-person-badge.me-2
                  | Empleados
                  if !usuario
                    |  
                    i.bi.bi-lock-fill.text-warning.small
              
              li.nav-item
                a.nav-link(class=(currentPath && currentPath.startsWith && currentPath.startsWith('/tareas') ? 'active' : ''), href="/tareas")
                  i.bi.bi-list-task.me-2
                  | Tareas
                  if !usuario
                    |  
                    i.bi.bi-lock-fill.text-warning.small
            
            //- Botones de AutenticaciÃ³n en Sidebar
            hr.my-3
            if usuario
              .d-grid
                a.btn.btn-outline-danger.btn-sm(
                  href='/auth/logout'
                  onclick='return confirm("Â¿Cerrar sesiÃ³n?")'
                )
                  i.bi.bi-box-arrow-right.me-1
                  | Cerrar SesiÃ³n
            else
              .d-grid.gap-2
                a.btn.btn-primary.btn-sm(href='/auth/login')
                  i.bi.bi-box-arrow-in-right.me-1
                  | Iniciar SesiÃ³n
                a.btn.btn-outline-primary.btn-sm(href='/auth/registro')
                  i.bi.bi-person-plus.me-1
                  | Registrarse

          //- Main Content
          .col-md-9.col-lg-10.main-content.p-4
            block content

      //- Footer pegado abajo
      footer.bg-dark.text-white.py-3.mt-auto
        .container
          .row
            .col-md-6
              p.mb-0 Â© 2025 Eventify - Sistema de GestiÃ³n de Eventos
            .col-md-6.text-md-end
              small VersiÃ³n 1.0.0

    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js")
    script(src="/js/filtros.js")
    block scripts

=====================================================

# Archivo: views\tareas\form.pug

//- views/tareas/form.pug
extends ../layout/layout

block content
  .row.justify-content-center
    .col-md-10
      .card.shadow
        .card-header.bg-info.text-white
          h4.mb-0
            i.bi.bi-list-task.me-2
            = formTitle

        .card-body
          if error
            .alert.alert-danger.alert-dismissible.fade.show(role='alert')
              i.bi.bi-exclamation-triangle-fill.me-2
              = error
              button.btn-close(type='button' data-bs-dismiss='alert')

          form(method='POST' action=formAction)
            .row
              .col-md-8.mb-3
                label.form-label(for='titulo')
                  i.bi.bi-card-text.me-1
                  | TÃ­tulo *
                input#titulo.form-control(
                  type='text'
                  name='titulo'
                  value=tarea ? tarea.titulo : ''
                  required
                  placeholder='TÃ­tulo de la tarea'
                )

        .mb-3
          label.form-label(for='descripcion')
            i.bi.bi-file-text.me-1
            | DescripciÃ³n
          textarea#descripcion.form-control(
            name='descripcion'
            rows='3'
            placeholder='Describe la tarea en detalle'
          )= tarea ? tarea.descripcion : ''

        .row
          .col-md-6.mb-3
            label.form-label(for='area')
              i.bi.bi-building.me-1
              | Ãrea *
            select#area.form-select(name='area' required)
              option(value='' selected=!tarea) Selecciona un Ã¡rea
              option(value='ProducciÃ³n y LogÃ­stica' selected=tarea && tarea.area === 'ProducciÃ³n y LogÃ­stica') ProducciÃ³n y LogÃ­stica
              option(value='PlanificaciÃ³n y Finanzas' selected=tarea && tarea.area === 'PlanificaciÃ³n y Finanzas') PlanificaciÃ³n y Finanzas

          .col-md-6.mb-3
            label.form-label(for='tipo')
              i.bi.bi-tag.me-1
              | Tipo *
            input#tipo.form-control(
              type='text'
              name='tipo'
              value=tarea ? tarea.tipo : ''
              required
              placeholder='Tipo de tarea segÃºn Ã¡rea'
            )

        .row
          .col-md-4.mb-3
            label.form-label(for='estado')
              i.bi.bi-circle.me-1
              | Estado
            select#estado.form-select(name='estado')
              option(value='pendiente' selected=!tarea || tarea.estado === 'pendiente') Pendiente
              option(value='en proceso' selected=tarea && tarea.estado === 'en proceso') En Proceso
              option(value='finalizada' selected=tarea && tarea.estado === 'finalizada') Finalizada

          .col-md-4.mb-3
            label.form-label(for='fechaInicio')
              i.bi.bi-calendar-check.me-1
              | Fecha Inicio
            input#fechaInicio.form-control(
              type='date'
              name='fechaInicio'
              value=tarea && tarea.fechaInicio ? tarea.fechaInicio.toISOString().split('T')[0] : ''
            )

          .col-md-4.mb-3
            label.form-label(for='fechaFin')
              i.bi.bi-calendar-x.me-1
              | Fecha Fin
            input#fechaFin.form-control(
              type='date'
              name='fechaFin'
              value=tarea && tarea.fechaFin ? tarea.fechaFin.toISOString().split('T')[0] : ''
            )

        .row
          .col-md-6.mb-3
            label.form-label(for='empleadoAsignado')
              i.bi.bi-person-badge.me-1
              | Empleado Asignado
            select#empleadoAsignado.form-select(name='empleadoAsignado')
              option(value='' selected=!tarea || !tarea.empleadoAsignado) Sin asignar
              each empleado in empleados
                option(
                  value=empleado.id
                  selected=tarea && tarea.empleadoAsignado && (tarea.empleadoAsignado.id === empleado.id || tarea.empleadoAsignado === empleado.id)
                )= `${empleado.nombre} - ${empleado.rol}`

          .col-md-6.mb-3
            label.form-label(for='eventoAsignado')
              i.bi.bi-calendar-event.me-1
              | Evento Asignado
            select#eventoAsignado.form-select(name='eventoAsignado')
              option(value='' selected=!tarea || !tarea.eventoAsignado) Sin evento
              each evento in eventos
                option(
                  value=evento.id
                  selected=tarea && tarea.eventoAsignado && (tarea.eventoAsignado.id === evento.id || tarea.eventoAsignado === evento.id)
                )= evento.nombre

        .row
          .col-md-6.mb-3
            label.form-label(for='horasEstimadas')
              i.bi.bi-clock.me-1
              | Horas Estimadas
            input#horasEstimadas.form-control(
              type='number'
              name='horasEstimadas'
              value=tarea ? tarea.horasEstimadas : 0
              min='0'
              step='0.5'
            )

          .col-md-6.mb-3
            label.form-label(for='horasReales')
              i.bi.bi-clock-history.me-1
              | Horas Reales
            input#horasReales.form-control(
              type='number'
              name='horasReales'
              value=tarea ? tarea.horasReales : 0
              min='0'
              step='0.5'
            )

        hr.my-4

        .d-flex.justify-content-between
          a.btn.btn-secondary(href='/tareas')
            i.bi.bi-arrow-left.me-1
            | Volver
          
          button.btn.btn-info(type='submit')
            i.bi.bi-check-circle.me-1
            | Guardar 

=====================================================

# Archivo: views\tareas\index.pug

//- views/tareas/index.pug
extends ../layout/layout

block content
  .d-flex.justify-content-between.align-items-center.mb-4
    h2
      i.bi.bi-list-task.text-info.me-2
      | Tareas
    a.btn.btn-info(href="/tareas/crear")
      i.bi.bi-plus-circle.me-1
      | Nueva Tarea

  // Filtros y bÃºsqueda
  .card.mb-4
    .card-body
      .row
        .col-md-8
          .input-group
            input.form-control(type="text", placeholder="Buscar tarea por tÃ­tulo, Ã¡rea o tipo...", id="searchInput")
            button.btn.btn-outline-primary(type="button", id="searchBtn")
              i.bi.bi-search.me-2
              | Buscar
        .col-md-4
          select.form-select#filterEstadoTareas
            option(value="all") Todos los estados
            option(value="pendiente") Pendiente
            option(value="en proceso") En proceso
            option(value="finalizada") Finalizada

  .card.shadow
    .card-body
      if tareas && tareas.length > 0
        .table-responsive
          table.table.table-hover
            thead.table-light
              tr
                th #
                th TÃ­tulo
                th Ãrea
                th Estado
                th Prioridad
                th Empleado
                th Evento
                th Acciones
            tbody
              each tarea, index in tareas
                tr
                  td= index + 1
                  td
                    strong= tarea.titulo
                    if tarea.descripcion
                      br
                      small.text-muted= tarea.descripcion.substring(0, 50) + (tarea.descripcion.length > 50 ? '...' : '')
                  td
                    small= tarea.area
                  td
                    span.badge(
                      class=tarea.estado === 'pendiente' ? 'bg-warning' : tarea.estado === 'en proceso' ? 'bg-info' : 'bg-success'
                    )= tarea.estado
                  td
                    span.badge(
                      class=tarea.prioridad === 'alta' ? 'bg-danger' : tarea.prioridad === 'media' ? 'bg-warning' : 'bg-secondary'
                    )= tarea.prioridad
                  td
                    if tarea.empleadoAsignado
                      small= tarea.empleadoAsignado.nombre
                    else
                      span.text-muted Sin asignar
                  td
                    if tarea.eventoAsignado
                      small= tarea.eventoAsignado.nombre
                    else
                      span.text-muted Sin evento
                  td
                    .btn-group(role='group')
                      a.btn.btn-sm.btn-outline-primary(
                        href=`/tareas/editar/${tarea.id}`
                        title='Editar'
                      )
                        i.bi.bi-pencil
                      a.btn.btn-sm.btn-outline-secondary(href=`/tareas/${tarea.id}` title='Ver')
                        i.bi.bi-eye
                      
                      form.d-inline(
                        method='POST'
                        action=`/tareas/eliminar/${tarea.id}`
                        onsubmit='return confirm("Â¿Eliminar esta tarea?")'
                      )
                        button.btn.btn-sm.btn-outline-danger(type='submit' title='Eliminar')
                          i.bi.bi-trash
      else
        .text-center.py-5
          i.bi.bi-clipboard-x.fs-1.text-muted.d-block.mb-3
          p.text-muted No hay tareas registradas
          a.btn.btn-info(href="/tareas/crear") Crear primera tarea

=====================================================

# Archivo: views\tareas\show.pug

extends ../layout/layout

block content
  .row.justify-content-center
    .col-lg-8
      .card
        .card-header.d-flex.justify-content-between.align-items-center
          h3.mb-0
            i.bi.bi-list-task.me-2
            | Detalle de la Tarea
          .btn-group
            a.btn.btn-outline-secondary(href=`/tareas/editar/${tarea.id}`)
              i.bi.bi-pencil.me-2
              | Editar
            a.btn.btn-outline-primary(href="/tareas")
              i.bi.bi-arrow-left.me-2
              | Volver

        .card-body
          h4= tarea.titulo
          if tarea.descripcion
            p= tarea.descripcion

          dl.row
            dt.col-md-3 Estado
            dd.col-md-9
              span.badge(class=tarea.estado === 'pendiente' ? 'bg-warning' : tarea.estado === 'en proceso' ? 'bg-info' : 'bg-success')= tarea.estado

            dt.col-md-3 Prioridad
            dd.col-md-9= tarea.prioridad

            dt.col-md-3 Ãrea
            dd.col-md-9= tarea.area

            dt.col-md-3 Tipo
            dd.col-md-9= tarea.tipo

            dt.col-md-3 Empleado asignado
            dd.col-md-9
              if tarea.empleadoAsignado
                a(href=`/empleados/${tarea.empleadoAsignado.id || tarea.empleadoAsignado._id}`)= tarea.empleadoAsignado.nombre
              else
                span.text-muted Sin asignar

            dt.col-md-3 Evento asignado
            dd.col-md-9
              if tarea.eventoAsignado
                a(href=`/eventos/ver/${tarea.eventoAsignado.id || tarea.eventoAsignado._id}`)= tarea.eventoAsignado.nombre
              else
                span.text-muted Sin evento

