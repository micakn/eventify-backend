//- views/tareas/index.pug
extends ../layout/layout

block content
  .d-flex.justify-content-between.flex-wrap.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom
    .d-flex.align-items-center
      .me-3
        i.bi.bi-list-task.fs-1.text-info
      div
        h1.mb-0 Gestión de Tareas
        p.lead.mb-0.text-muted Organiza y asigna el trabajo del equipo
    
    .btn-toolbar.mb-2.mb-md-0
      a.btn.btn-info(href="/tareas/crear")
        i.bi.bi-plus-circle.me-2
        | Nueva Tarea

  // Filtros y búsqueda
  .card.mb-4
    .card-body
      .row
        .col-md-8
          .input-group
            input.form-control(type="text", placeholder="Buscar tarea por título, área o tipo...", id="searchInput")
            button.btn.btn-outline-primary(type="button", id="searchBtn")
              i.bi.bi-search.me-2
              | Buscar
        .col-md-4
          select.form-select#filterEstadoTareas
            option(value="all") Todos los estados
            option(value="pendiente") Pendiente
            option(value="en proceso") En proceso
            option(value="finalizada") Finalizada

  .card.shadow
    .card-body
      if tareas && tareas.length > 0
        .table-responsive
          table.table.table-hover
            thead
              tr.encabezado-tabla
                th Título
                th Área
                th Estado
                th Prioridad
                th Empleado
                th Evento
                th Acciones
            tbody
              each tarea in tareas
                tr
                  td
                    strong= tarea.titulo
                    if tarea.descripcion
                      br
                      small.text-muted= tarea.descripcion.substring(0, 50) + (tarea.descripcion.length > 50 ? '...' : '')
                  td
                    small= tarea.area
                  td
                    span.badge(
                      class=tarea.estado === 'pendiente' ? 'bg-warning' : tarea.estado === 'en proceso' ? 'bg-info' : 'bg-success'
                    )= tarea.estado
                  td
                    span.badge(
                      class=tarea.prioridad === 'alta' ? 'bg-danger' : tarea.prioridad === 'media' ? 'bg-warning' : 'bg-secondary'
                    )= tarea.prioridad
                  td
                    if tarea.empleadoAsignado
                      small= tarea.empleadoAsignado.nombre
                    else
                      span.text-muted Sin asignar
                  td
                    if tarea.eventoAsignado
                      small= tarea.eventoAsignado.nombre
                    else
                      span.text-muted Sin evento
                  td
                    .btn-group.btn-group-sm(role='group')
                      a.btn.btn-sm.btn-outline-secondary(href=`/tareas/${tarea.id}` title='Ver')
                        i.bi.bi-eye
                      a.btn.btn-sm.btn-outline-primary(
                        href=`/tareas/editar/${tarea.id}`
                        title='Editar'
                      )
                        i.bi.bi-pencil
                      
                      form.d-inline(
                        method='POST'
                        action=`/tareas/eliminar/${tarea.id}`
                        onsubmit='return confirm("¿Estás seguro de eliminar esta tarea?")'
                      )
                        button.btn.btn-sm.btn-outline-danger(type='submit' title='Eliminar')
                          i.bi.bi-trash
      else
        .text-center.py-5
          i.bi.bi-clipboard-x.fs-1.text-muted.d-block.mb-3
          p.text-muted No hay tareas registradas
          a.btn.btn-info(href="/tareas/crear") Crear primera tarea